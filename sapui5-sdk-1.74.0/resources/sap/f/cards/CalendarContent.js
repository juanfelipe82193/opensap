/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/f/library","sap/f/cards/BaseContent","sap/f/cards/CardActions","sap/f/cards/IconFormatter","sap/f/cards/BindingHelper","sap/f/cards/BindingResolver","sap/f/PlanningCalendarInCard","sap/f/PlanningCalendarInCardRow","sap/f/PlanningCalendarInCardLegend","sap/m/library","sap/m/PlanningCalendar","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/unified/CalendarAppointment","sap/ui/unified/DateTypeRange","sap/ui/unified/CalendarLegendItem"],function(l,B,C,I,a,b,P,c,d,L,e,F,f,g,D,h){"use strict";var A=l.cards.AreaType,i=L.PlanningCalendarBuiltInView;var j=B.extend("sap.f.cards.CalendarContent",{renderer:{}});j.prototype._createCalendar=function(){this._oCalendar=new P(this.getId()+"-PC",{showWeekNumbers:true,builtInViews:[i.OneMonth],rows:[new c(this.getId()+"-Row",{})],intervalSelect:function(E){this._setParameters(E,E.getParameter("startDate"));}.bind(this)});this.setAggregation("_content",this._oCalendar);this._oCalendar.attachEvent("_todayPressed",new Date(),this._setParameters);};j.prototype.init=function(){B.prototype.init.apply(this,arguments);this._createCalendar();this.fireEvent("_actionContentReady");};j.prototype.exit=function(){B.prototype.exit.apply(this,arguments);if(this._oAppointmentTemplate){this._oAppointmentTemplate.destroy();this._oAppointmentTemplate=null;}if(this._oHeaderTemplate){this._oHeaderTemplate.destroy();this._oHeaderTemplate=null;}if(this._oSpecialDateTemplate){this._oSpecialDateTemplate.destroy();this._oSpecialDateTemplate=null;}if(this._oCalendarLegendItemTemplate){this._oCalendarLegendItemTemplate.destroy();this._oCalendarLegendItemTemplate=null;}if(this._oAppointmentLegendItemTemplate){this._oAppointmentLegendItemTemplate.destroy();this._oAppointmentLegendItemTemplate=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}};j.prototype.onAfterRendering=function(){var o;if(!this._bIsDataReady){o=this.getParent();if(o.isReady()){this._setParameters();}else{o.attachEventOnce("_ready",this._setParametersInModel,this);}}};j.prototype.setConfiguration=function(o){B.prototype.setConfiguration.apply(this,arguments);if(!o){return this;}if(o.item){this._addItem(o.item);}if(o.specialDate){this._addSpecialDate(o.specialDate);}if(o.legendItem){this._addLegendItem(o.legendItem);}if(o.date){this._addDate(o.date);}if(o.maxItems){this._addMaxItems(o.maxItems);}if(o.maxLegendItems){this._addMaxLegendItems(o.maxLegendItems);}if(o.noItemsText){this._addNoItemsText(o.noItemsText);}if(o.moreItems&&o.moreItems.actions){this._oActions=new C({areaType:A.Content});this._oActions.attach(o.moreItems,this._oCalendar.getRows()[0]._getMoreButton());}return this;};j.prototype._setParameters=function(E,o){var k=o?o:this._oCalendar.getStartDate(),s=new Date(k.getFullYear(),k.getMonth(),k.getDate()),m=new Date(k.getFullYear(),k.getMonth(),k.getDate()),n=this.getConfiguration&&this.getConfiguration(),p=n&&n.item&&n.item.path,M,q,r,v,t;m.setDate(m.getDate()+1);r=p?this.getModel().getProperty(p).filter(function(u){var S=new Date(u.start).getTime(),w=new Date(u.end).getTime();if((S>=s.getTime()&&S<m.getTime())||(w>=s.getTime()&&w<m.getTime())||(S<=s.getTime()&&w>m.getTime())){return u;}}):[];if(n&&typeof n.maxItems==="object"){M=n&&this.getConfiguration().maxItems&&"/"+this.getConfiguration().maxItems.binding.getPath();q=this.getModel().getProperty(M);}else{q=n&&this.getConfiguration().maxItems;}t=r.length;if(t<q){v=t;}else{v=q;}this._bIsDataReady=true;this.getModel("parameters").setProperty("/visibleItems",v);this.getModel("parameters").setProperty("/allItems",t);};j.prototype.dateFormatter=function(t){return new Date(t);};j.prototype._addItem=function(m){var k={title:m.template.title,text:m.template.text,type:m.template.type},o,n={title:m.template.title,text:m.template.text,type:m.template.type},p;if(m.template.startDate){k.startDate=a.formattedProperty(m.template.startDate,this.dateFormatter);}if(m.template.endDate){k.endDate=a.formattedProperty(m.template.endDate,this.dateFormatter);}if(m.template.icon&&m.template.icon.src){k.icon=a.formattedProperty(m.template.icon.src,function(v){return I.formatSrc(v,this._sAppId);}.bind(this));}this._oAppointmentTemplate=new g(k);o={path:m.path,template:this._oAppointmentTemplate,filters:new F({path:"visualization",operator:f.Contains,value1:"appointment"})};this._bindAggregation("appointments",this._oCalendar.getRows()[0],o);if(m.template.startDate){n.startDate=a.formattedProperty(m.template.startDate,this.dateFormatter);}if(m.template.endDate){n.endDate=a.formattedProperty(m.template.endDate,this.dateFormatter);}if(m.template.icon&&m.template.icon.src){n.icon=a.formattedProperty(m.template.icon.src,function(v){return I.formatSrc(v,this._sAppId);}.bind(this));}this._oHeaderTemplate=new g(n);p={path:m.path,template:this._oHeaderTemplate,filters:new F({path:"visualization",operator:f.Contains,value1:"blocker"})};this._bindAggregation("intervalHeaders",this._oCalendar.getRows()[0],p);};j.prototype._addSpecialDate=function(s){var S=s.template,o;if(S.startDate){S.startDate=a.formattedProperty(S.startDate,this.dateFormatter);}if(S.endDate){S.endDate=a.formattedProperty(S.endDate,this.dateFormatter);}this._oSpecialDateTemplate=new D(S);o={path:s.path,template:this._oSpecialDateTemplate};this._bindAggregation("specialDates",this._oCalendar,o);};j.prototype._addLegendItem=function(m){var k={text:m.template.text,type:m.template.type},n={text:m.template.text,type:m.template.type},o,p;this._oCalendarLegendItemTemplate=new h(k);o={path:m.path,template:this._oCalendarLegendItemTemplate,filters:new F({path:"category",operator:f.Contains,value1:"calendar"})};this._bindAggregation("items",this._oCalendar._getLegend(),o);this._oAppointmentLegendItemTemplate=new h(n);p={path:m.path,template:this._oAppointmentLegendItemTemplate,filters:new F({path:"category",operator:f.Contains,value1:"appointment"})};this._bindAggregation("appointmentItems",this._oCalendar._getLegend(),p);};j.prototype._addDate=function(t){if(b.isBindingInfo(t)){t&&this._oCalendar.bindProperty("startDate",a.formattedProperty(t,this.dateFormatter));}else{this._oCalendar.setStartDate(this.dateFormatter(t));}};j.prototype._addMaxItems=function(m){if(b.isBindingInfo(m)){m&&this._oCalendar.getRows()[0].bindProperty("visibleAppointmentsCount",m);}else{this._oCalendar.getRows()[0].setVisibleAppointmentsCount(m);}};j.prototype._addMaxLegendItems=function(m){if(b.isBindingInfo(m)){m&&this._oCalendar._getLegend().bindProperty("visibleLegendItemsCount",m);}else{this._oCalendar._getLegend().setVisibleLegendItemsCount(m);}};j.prototype._addNoItemsText=function(n){if(b.isBindingInfo(n)){n&&this._oCalendar.getRows()[0].bindProperty("noAppointmentsText",n);}else{this._oCalendar.getRows()[0].setNoAppointmentsText(n);}};return j;});
