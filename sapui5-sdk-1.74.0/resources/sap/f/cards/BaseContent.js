/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/base/Log","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","sap/f/cards/CardActions","./BindingHelper"],function(C,J,L,M,a,b,B){"use strict";var c=C.extend("sap.f.cards.BaseContent",{metadata:{library:"sap.f",aggregations:{_content:{multiple:false,visibility:"hidden"}},events:{press:{}}},renderer:function(r,o){var s="sapFCard";var l=o.getMetadata().getLibraryName();var n=o.getMetadata().getName();var t=n.slice(l.length+1,n.length);var h=c.getMinHeight(t,o.getConfiguration());var d=o.getParent();s+=t;r.write("<div");r.writeElementData(o);r.addClass(s);r.addClass("sapFCardBaseContent");r.writeClasses();if(d&&d.isA("sap.f.ICard")&&d.getHeight()==="auto"){r.addStyle("min-height",h);}r.writeStyles();r.write(">");r.renderControl(o.getAggregation("_content"));r.write("</div>");}});c.prototype.init=function(){this._aReadyPromises=[];this._bReady=false;this._mObservers={};this._awaitEvent("_dataReady");this._awaitEvent("_actionContentReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready");}.bind(this));this.setBusyIndicatorDelay(0);this._oActions=new b();};c.prototype.ontap=function(e){if(!e.isMarked()){this.firePress({});}};c.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}};c.prototype._awaitEvent=function(e){this._aReadyPromises.push(new Promise(function(r){this.attachEventOnce(e,function(){r();});}.bind(this)));};c.prototype.destroy=function(){this.setAggregation("_content",null);this.setModel(null);this._aReadyPromises=null;if(this._mObservers){Object.keys(this._mObservers).forEach(function(k){this._mObservers[k].disconnect();delete this._mObservers[k];},this);}return C.prototype.destroy.apply(this,arguments);};c.prototype.setConfiguration=function(o){this._oConfiguration=o;if(!o){return this;}var l=this.getInnerList(),m=o.maxItems;if(l&&m){l.setGrowing(true);l.setGrowingThreshold(parseInt(m));l.addStyleClass("sapFCardMaxItems");}this._setData(o.data);return this;};c.prototype.getConfiguration=function(){return this._oConfiguration;};c.prototype.getInnerList=function(){return null;};c.prototype._setData=function(d){var p="/";if(d&&d.path){p=d.path;}this.bindObject(p);if(this._oDataProvider){this._oDataProvider.destroy();}if(this._oDataProviderFactory){this._oDataProvider=this._oDataProviderFactory.create(d,this._oServiceManager);}if(this._oDataProvider){this.setBusy(true);this.setModel(new J());this._oDataProvider.attachDataChanged(function(e){this._updateModel(e.getParameter("data"));this.setBusy(false);}.bind(this));this._oDataProvider.attachError(function(e){this._handleError(e.getParameter("message"));this.setBusy(false);}.bind(this));this._oDataProvider.triggerDataUpdate().then(function(){this.fireEvent("_dataReady");}.bind(this));}else{this.fireEvent("_dataReady");}};function _(A,o,d){var e=this.getBindingContext(),f=o.getAggregation(A);if(e){d.path=d.path||e.getPath();o.bindAggregation(A,d);if(this.getModel("parameters")&&f){this.getModel("parameters").setProperty("/visibleItems",f.length);}if(!this._mObservers[A]){this._mObservers[A]=new M(function(g){if(g.name===A&&(g.mutation==="insert"||g.mutation==="remove")){var f=o.getAggregation(A);var l=f?f.length:0;if(this.getModel("parameters")){this.getModel("parameters").setProperty("/visibleItems",l);}}}.bind(this));this._mObservers[A].observe(o,{aggregations:[A]});}}}c.prototype._bindAggregation=function(A,o,d){var e=A&&typeof A==="string";var f=d&&typeof d==="object";if(!e||!o||!f){return;}if(this.getBindingContext()){_.apply(this,arguments);}else{o.attachModelContextChange(_.bind(this,A,o,d));}};c.prototype.isReady=function(){return this._bReady;};c.prototype._updateModel=function(d){this.getModel().setData(d);};c.prototype._handleError=function(l){this.fireEvent("_error",{logMessage:l});};c.prototype.setServiceManager=function(s){this._oServiceManager=s;return this;};c.prototype.setDataProviderFactory=function(d){this._oDataProviderFactory=d;return this;};c.create=function(t,o,s,d,A){return new Promise(function(r,e){var f=function(g){var h=new g();h._sAppId=A;h.setServiceManager(s);h.setDataProviderFactory(d);h.setConfiguration(B.createBindingInfos(o));r(h);};try{switch(t.toLowerCase()){case"list":sap.ui.require(["sap/f/cards/ListContent"],f);break;case"calendar":sap.ui.require(["sap/f/cards/CalendarContent"],f);break;case"table":sap.ui.require(["sap/f/cards/TableContent"],f);break;case"object":sap.ui.require(["sap/f/cards/ObjectContent"],f);break;case"analytical":a.loadLibrary("sap.viz",{async:true}).then(function(){sap.ui.require(["sap/f/cards/AnalyticalContent"],f);}).catch(function(){e("Analytical content type is not available with this distribution.");});break;case"analyticscloud":sap.ui.require(["sap/f/cards/AnalyticsCloudContent"],f);break;case"timeline":a.loadLibrary("sap.suite.ui.commons",{async:true}).then(function(){sap.ui.require(["sap/f/cards/TimelineContent"],f);}).catch(function(){e("Timeline content type is not available with this distribution.");});break;case"component":sap.ui.require(["sap/f/cards/ComponentContent"],f);break;case"adaptivecard":sap.ui.require(["sap/f/cards/AdaptiveContent"],f);break;default:e(t.toUpperCase()+" content type is not supported.");}}catch(E){e(E);}});};c.getMinHeight=function(t,o){var d=5,h;if(jQuery.isEmptyObject(o)){return"0rem";}switch(t){case"ListContent":h=c._getMinListHeight(o);break;case"TableContent":h=c._getMinTableHeight(o);break;case"TimelineContent":h=c._getMinTimelineHeight(o);break;case"AnalyticalContent":h=14;break;case"AnalyticsCloudContent":h=14;break;case"ObjectContent":h=0;break;default:h=0;}return(h!==0?h:d)+"rem";};c._getMinListHeight=function(o){var i=o.maxItems||0,t=o.item,I=3;if(!t){return 0;}if(t.icon||t.description){I=4;}return i*I;};c._getMinTableHeight=function(o){var i=o.maxItems||0,r=2,t=2;return i*r+t;};c._getMinTimelineHeight=function(o){var i=o.maxItems||0,I=6;return i*I;};return c;});
