/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/library","sap/f/library","sap/ui/core/Control","sap/m/Text","sap/f/Avatar","sap/ui/Device",'sap/ui/model/json/JSONModel',"sap/f/cards/HeaderRenderer","sap/f/cards/IconFormatter","sap/f/cards/CardActions","sap/base/strings/formatMessage","sap/f/cards/BindingHelper","sap/ui/core/Core"],function(l,a,C,T,A,D,J,H,I,b,f,B,c){"use strict";var d=l.AvatarShape;var e=a.cards.AreaType;var g=C.extend("sap.f.cards.Header",{metadata:{library:"sap.f",interfaces:["sap.f.cards.IHeader"],properties:{title:{type:"string",defaultValue:""},subtitle:{type:"string",defaultValue:""},statusText:{type:"string",defaultValue:""},iconDisplayShape:{type:"sap.m.AvatarShape",defaultValue:d.Circle},iconSrc:{type:"sap.ui.core.URI",defaultValue:""},iconInitials:{type:"string",defaultValue:""}},aggregations:{_title:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_subtitle:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_avatar:{type:"sap.f.Avatar",multiple:false,visibility:"hidden"}},events:{press:{}}}});g.prototype.init=function(){this._oRb=c.getLibraryResourceBundle("sap.f");this._aReadyPromises=[];this._bReady=false;this._awaitEvent("_dataReady");this._awaitEvent("_actionHeaderReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready");}.bind(this));this.setBusyIndicatorDelay(0);};g.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;this._oRb=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}};g.prototype._awaitEvent=function(E){this._aReadyPromises.push(new Promise(function(r){this.attachEventOnce(E,function(){r();});}.bind(this)));};g.prototype.isReady=function(){return this._bReady;};g.prototype._getTitle=function(){var t=this.getAggregation("_title");if(!t){t=new T({maxLines:3}).addStyleClass("sapFCardTitle");this.setAggregation("_title",t);}return t;};g.prototype._getSubtitle=function(){var s=this.getAggregation("_subtitle");if(!s){s=new T({maxLines:2}).addStyleClass("sapFCardSubtitle");this.setAggregation("_subtitle",s);}return s;};g.prototype._getAvatar=function(){var o=this.getAggregation("_avatar");if(!o){o=new A().addStyleClass("sapFCardIcon");this.setAggregation("_avatar",o);}return o;};g.prototype.onBeforeRendering=function(){this._getTitle().setText(this.getTitle());this._getSubtitle().setText(this.getSubtitle());this._getAvatar().setDisplayShape(this.getIconDisplayShape());this._getAvatar().setSrc(this.getIconSrc());this._getAvatar().setInitials(this.getIconInitials());};g.prototype._getHeaderAccessibility=function(){var t=this._getTitle()?this._getTitle().getId():"",s=this._getSubtitle()?this._getSubtitle().getId():"",h=this._getAvatar()?this._getAvatar().getId():"";return t+" "+s+" "+h;};g.prototype.onAfterRendering=function(){if(D.browser.msie){if(this.getTitle()){this._getTitle().clampText();}if(this.getSubtitle()){this._getSubtitle().clampText();}}};g.prototype.ontap=function(){this.firePress();};g.create=function(m,s,o,h){var S={title:m.title,subtitle:m.subTitle};if(m.icon){S.iconSrc=m.icon.src;S.iconDisplayShape=m.icon.shape;S.iconInitials=m.icon.text;}if(m.status&&typeof m.status.text==="string"){S.statusText=m.status.text;}S=B.createBindingInfos(S);if(S.iconSrc){S.iconSrc=B.formattedProperty(S.iconSrc,function(v){return I.formatSrc(v,h);});}var i=new g(S);i._sAppId=h;if(m.status&&m.status.text&&m.status.text.format){g._bindStatusText(m.status.text.format,i);}i.setServiceManager(s);i.setDataProviderFactory(o);i._setData(m.data);i._setAccessibilityAttributes(m);var j=new b({areaType:e.Header});j.attach(m,i);i._oActions=j;return i;};g._bindStatusText=function(F,h){if(F.parts&&F.translationKey&&F.parts.length===2){var o={parts:[F.translationKey,F.parts[0].toString(),F.parts[1].toString()],formatter:function(t,p,P){var s=p||F.parts[0];var i=P||F.parts[1];if(Array.isArray(p)){s=p.length;}if(Array.isArray(P)){i=P.length;}var j=parseFloat(s)||0;var k=parseFloat(i)||0;return f(t,[j,k]);}};h.bindProperty("statusText",o);}};g.prototype.setServiceManager=function(s){this._oServiceManager=s;return this;};g.prototype.setDataProviderFactory=function(o){this._oDataProviderFactory=o;return this;};g.prototype._setData=function(o){var p="/";if(o&&o.path){p=o.path;}this.bindObject(p);if(this._oDataProvider){this._oDataProvider.destroy();}this._oDataProvider=this._oDataProviderFactory.create(o,this._oServiceManager);if(this._oDataProvider){this.setBusy(true);this.setModel(new J());this._oDataProvider.attachDataChanged(function(E){this._updateModel(E.getParameter("data"));this.setBusy(false);}.bind(this));this._oDataProvider.attachError(function(E){this._handleError(E.getParameter("message"));this.setBusy(false);}.bind(this));this._oDataProvider.triggerDataUpdate().then(function(){this.fireEvent("_dataReady");}.bind(this));}else{this.fireEvent("_dataReady");}};g.prototype._setAccessibilityAttributes=function(m){if(!m.actions){this._sAriaRole='heading';this._sAriaHeadingLevel='3';this._sAriaRoleDescritoion=this._oRb.getText("ARIA_ROLEDESCRIPTION_CARD_HEADER");}else{this._sAriaRole='button';this._sAriaHeadingLevel=undefined;this._sAriaRoleDescritoion=this._oRb.getText("ARIA_ROLEDESCRIPTION_INTERACTIVE_CARD_HEADER");}};g.prototype._updateModel=function(o){this.getModel().setData(o);};g.prototype._handleError=function(L){this.fireEvent("_error",{logMessage:L});};return g;});
