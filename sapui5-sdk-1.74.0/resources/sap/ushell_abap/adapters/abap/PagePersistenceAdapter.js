// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/model/odata/v2/ODataModel","sap/ushell/resources"],function(O,a,r){"use strict";var P=function(s,p,b){this.S_COMPONENT_NAME="sap.ushell_abap.adapters.abap.PagePersistenceAdapter";var c=(O.get("config.serviceUrl",b)||"").replace(/\/?$/,"/");this._oODataModel=new a({serviceUrl:c,headers:{"sap-language":sap.ushell.Container.getUser().getLanguage(),"sap-client":(s&&s.getClient())||sap.ushell.Container.getLogonSystem().getClient()},defaultCountMode:"None",skipMetadataAnnotationParsing:true,useBatch:false});};P.prototype.getPage=function(p){var o=this._readPage(p).then(this._convertODataToReferencePage).catch(this._rejectWithError.bind(this));return o;};P.prototype._readPage=function(p){var o=new Promise(function(b,c){this._oODataModel.read("/pageSet('"+encodeURIComponent(p)+"')",{urlParameters:{"$expand":"sections/tiles"},success:b,error:c});}.bind(this));return o;};P.prototype._convertODataToReferencePage=function(p){return{content:{id:p.id,title:p.title,description:p.description,sections:p.sections.results.map(function(s){return{id:s.id,title:s.title,visualizations:s.tiles.results.map(function(t){return{id:t.id,vizId:t.catalogTile,inboundPermanentKey:t.targetMapping};})};})}};};P.prototype._rejectWithError=function(e){var E={component:this.S_COMPONENT_NAME,description:r.i18n.getText("PagePersistenceAdapter.CannotLoadPage"),detail:e};return Promise.reject(E);};return P;},true);
