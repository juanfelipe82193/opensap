/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/Object","./AnimationTrackType","./findIndexInArray","./AnimationPlayer","./Core"],function(B,A,f,a,v){"use strict";var b=B.extend("sap.ui.vk.AnimationSequence",{constructor:function(i,p){this._id=i;this._name=p&&p.name?p.name:"";this._duration=p&&p.duration?p.duration:1.0;this._joints=[];this._animations=new Map();}});b.prototype.getId=function(){return this._id;};b.prototype.getName=function(){return this._name;};b.prototype.setName=function(n){this._name=n;return this;};b.prototype.getDuration=function(){return this._duration;};b.prototype.setDuration=function(d){this._duration=d;return this;};b.prototype._findJointIndex=function(p,n){return f(this._joints,function(j){return(p?j.parent==p:true)&&(n?j.node==n:true);});};b.prototype.setJoint=function(j){if(!Array.isArray(j)){j=[j];}j.forEach(function(d){var i=this._findJointIndex(d.parent,d.node);if(i<0){this._joints.push(d);}else{this._joints[i].translation=d.translation;this._joints[i].quaternion=d.quaternion;this._joints[i].scale=d.scale;}},this);this._fireSequenceChanged();return this;};b.prototype.getJoint=function(j){var r;if(!j||(!j.parent&&!j.node)){r=this._joints;}else if(j&&j.node){r=this._joints.filter(function(i){return i.node==j.node&&(j.parent?i.parent==j.parent:true);});}else if(j&&j.parent&&!j.node){r=this._joints.filter(function(i){return i.parent==j.parent;});}return r;};b.prototype.removeJoint=function(j){if(!j){this._joints.splice(0);}else if(j&&(j.node||j.parent)){var i;do{i=this._findJointIndex(j.parent,j.node);if(i>=0){this._joints.splice(i,1);}}while(i>=0);}this._fireSequenceChanged();return this;};b.prototype.getNodeAnimation=function(n,p){var c=function(n){var d=this._animations.get(n);var r;if(d){if(p){r=d[p];}else{r={nodeRef:n};for(var t in A){var e=A[t];if(d[e]){r[e]=d[e];}}}}return r;}.bind(this);var r;if(n&&!Array.isArray(n)){var d=this._animations.get(n);if(!d){return undefined;}r=p?d[p]:d;}else if(!n){r=[];this._animations.forEach(function(d,e){r.push(c(e,p));},this);}else{r=[];n.forEach(function(e){r.push(c(e,p));},this);}return r;};b.prototype.setNodeAnimation=function(n,p,t){var d=this._animations.get(n);if(!d){d={};this._animations.set(n,d);}d[p]=t;return this;};b.prototype.removeNodeAnimation=function(n,p){if(!p){this._animations.delete(n);}else{var d=this._animations.get(n);if(d){delete d[p];}}return this;};b.prototype.resetDuration=function(){var m=0;this._animations.forEach(function(d,n){var t;for(var c in d){var e=d[c];if(e){if(e.getKeysCount()){var k=e.getKey(e.getKeysCount()-1);t=k.time;}if(t&&t>m){m=t;}}}},this);if(m>0.0){this._duration=m;}return this;};b.prototype.getNodesBoundaryValues=function(i){var r=new Map();var s=function(n,p,c){var d=r.get(n);if(!d){d={};r.set(n,d);}d[p]=c;};this._animations.forEach(function(d,n){for(var t in d){var c=d[t];if(c){var e=a.getBoundaryKey(c,i);s(n,t,e.value);}}});return r;};b.prototype._fireSequenceChanged=function(){v.getEventBus().publish("sap.ui.vk","sequenceChanged",{sequenceId:this._id});};return b;});
