/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/integration/designtime/baseEditor/util/findClosestInstance","sap/ui/integration/designtime/baseEditor/util/createPromise","sap/ui/integration/designtime/baseEditor/util/escapeParameter","sap/base/util/isPlainObject"],function(C,f,c,e,i){"use strict";var a="config";var b="propertyName";var P=C.extend("sap.ui.integration.designtime.baseEditor.PropertyEditor",{metadata:{properties:{propertyName:{type:"string"},renderLabel:{type:"boolean"},config:{type:"object"}},aggregations:{propertyEditor:{type:"sap.ui.integration.designtime.baseEditor.propertyEditor.BasePropertyEditor",multiple:false,visibility:"hidden"}},associations:{editor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor",multiple:false}},events:{editorChange:{parameters:{previousEditor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor"},editor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor"}}},propertyEditorChange:{parameters:{previousPropertyEditor:{type:"sap.ui.integration.designtime.baseEditor.propertyEditor.BasePropertyEditor"},propertyEditor:{type:"sap.ui.integration.designtime.baseEditor.propertyEditor.BasePropertyEditor"}}},configChange:{parameters:{previousConfig:{type:"object"},config:{type:"object"}}},propertyNameChange:{parameters:{previousPropertyName:{type:"string"},propertyName:{type:"string"}}}}},_bEditorAutoDetect:false,_sCreatedBy:null,constructor:function(){C.prototype.constructor.apply(this,e(arguments,"config"));if(!this.getEditor()){this._bEditorAutoDetect=true;}this._propagationListener=this._propagationListener.bind(this);this.attachEditorChange(function(){if(this._sCreatedBy){this._removePropertyEditor();}this._initPropertyEditor();});this.attachConfigChange(function(E){if(this._sCreatedBy){this._removePropertyEditor();}this._initPropertyEditor();});this.attachPropertyNameChange(function(){if(this._sCreatedBy===b){this._removePropertyEditor();}if(this._sCreatedBy!==a){this._initPropertyEditor();}});this._initPropertyEditor();},renderer:function(r,o){r.openStart("div",o);r.openEnd();r.renderControl(o.getAggregation("propertyEditor"));r.close("div");}});P.prototype.getEditor=function(){return sap.ui.getCore().byId(this.getAssociation("editor"));};P.prototype.setConfig=function(m){var p=this.getConfig();if(p!==m&&(!i(p)||!i(m)||JSON.stringify(p)!==JSON.stringify(m))){this.setProperty("config",m);this.fireConfigChange({previousConfig:p,config:m});}};P.prototype.setPropertyName=function(p){var s=this.getPropertyName();if(s!==p){this.setProperty("propertyName",p);this.firePropertyNameChange({previousPropertyName:s,propertyName:p});}};P.prototype.setEditor=function(E){var p=this.getEditor();var o=typeof E==="string"?sap.ui.getCore().byId(E):E;if(p!==o){this.setAssociation("editor",E);var o=this.getEditor();this.fireEditorChange({previousEditor:p,editor:o});}};P.prototype.destroy=function(){this._removePropertyEditor();C.prototype.destroy.apply(this,arguments);};P.prototype._removePropertyEditor=function(){var p=this.getAggregation("propertyEditor");if(p){this.setAggregation("propertyEditor",null);switch(this._sCreatedBy){case a:p.destroy();break;case b:p.setParent(null);break;}this._sCreatedBy=null;this.firePropertyEditorChange({propertyEditor:null});}};P.prototype._initPropertyEditor=function(){if(this.getEditor()&&(this.getConfig()||(!this.getBindingInfo("config")&&this.getPropertyName()))){var E=this.getEditor();if(this._fnCancelInit){this._fnCancelInit();delete this._fnCancelInit;}var p=c(function(r,R){var o;var s;if(this.getConfig()){o=E.createPropertyEditor(this.getConfig());s=a;}else{o=E.getPropertyEditor(this.getPropertyName());s=b;}o.then(function(d){var g=this.getRenderLabel();if(g!==undefined){d.setRenderLabel(g);}this._sCreatedBy=s;delete this._fnCancelInit;r(d);}.bind(this)).catch(R);}.bind(this));this._fnCancelInit=p.cancel;p.promise.then(function(o){this.setAggregation("propertyEditor",o);this.firePropertyEditorChange({propertyEditor:o});}.bind(this));}};P.prototype._propagationListener=function(){var E=f(this.getParent(),"sap.ui.integration.designtime.baseEditor.BaseEditor");if(E){this.setEditor(E);this.removePropagationListener(this._propagationListener);}};P.prototype.setParent=function(p){C.prototype.setParent.apply(this,arguments);if(this._bEditorAutoDetect){var E=f(p,"sap.ui.integration.designtime.baseEditor.BaseEditor");if(E){this.setEditor(E);}else{this.addPropagationListener(this._propagationListener);}}};return P;});
