/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/base/util/deepClone","sap/base/util/ObjectPath","sap/ui/model/json/JSONModel","sap/base/util/restricted/_merge","sap/base/util/restricted/_omit","sap/base/util/isPlainObject"],function(B,d,O,J,_,a,i){"use strict";var M=B.extend("sap.ui.integration.designtime.baseEditor.propertyEditor.mapEditor.MapEditor",{xmlFragment:"sap.ui.integration.designtime.baseEditor.propertyEditor.mapEditor.MapEditor",init:function(){this._itemsModel=new J();this._itemsModel.setDefaultBindingMode("OneWay");this.setModel(this._itemsModel,"itemsModel");},onValueChange:function(){var c=this.getConfig();if(c.value){var I=Object.keys(c.value).map(function(k){return{key:k,value:[{type:i(c.value[k])?"json":"string",path:k,value:c.value[k]}]};});this._itemsModel.setData(I);}},_onRemoveElement:function(e){var k=e.getSource().getBindingContext("itemsModel").getObject().key;var p=this.getConfig().value;this.firePropertyChange(a(p,k));},_onAddElement:function(){var p=_({},this.getValue());var k=this._getUniqueKey(p);p[k]="";this.firePropertyChange(p);},_getUniqueKey:function(p){var k="key";var I=0;while(p.hasOwnProperty(k)){k="key"+ ++I;}return k;},_onKeyChange:function(e){var I=(this._itemsModel.getData()||[]).slice();var o=e.getSource();var n=e.getParameter("value");var s=o.getBindingContext("itemsModel").getObject().key;var k=I.map(function(b){return b.key;});var E=k.indexOf(s);if(E>=0&&(k.indexOf(n)<0||n===s)){o.setValueState("None");var b=d(I[E]);b.key=n;I.splice(E,1,b);if(n!==s){var m={};I.forEach(function(b){m[b.key]=b.value[0].value;});this.firePropertyChange(m);}}else{o.setValueState("Error");o.setValueStateText(this.getI18nProperty("BASE_EDITOR.MAP.DUPLICATE_KEY"));}},_propertyEditorsChange:function(e){var p=e.getParameter("previousPropertyEditors")[0];var P=e.getParameter("propertyEditors")[0];if(p){p.detachPropertyChange(this._onPropertyValueChange,this);}if(P){P.attachPropertyChange(this._onPropertyValueChange,this);}},_onPropertyValueChange:function(e){var E=_({},this.getValue());var p=e.getParameter("path");var P=p.split("/");var v=e.getParameter("value");O.set(P,v,E);this.firePropertyChange(E);},renderer:B.getMetadata().getRenderer().render});return M;});
