/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/base/util/deepClone","sap/base/util/ObjectPath","sap/ui/model/json/JSONModel","sap/base/util/restricted/_merge"],function(B,d,O,J,_){"use strict";var A=B.extend("sap.ui.integration.designtime.baseEditor.propertyEditor.arrayEditor.ArrayEditor",{xmlFragment:"sap.ui.integration.designtime.baseEditor.propertyEditor.arrayEditor.ArrayEditor",metadata:{properties:{value:{type:"any"}}},renderer:B.getMetadata().getRenderer().render});A.prototype.init=function(){this._itemsModel=new J();this._itemsModel.setDefaultBindingMode("OneWay");this.setModel(this._itemsModel,"itemsModel");};A.prototype.onValueChange=function(){var r=B.prototype.onValueChange.apply(this,arguments);var c=this.getConfig();if(c.value&&c.template){var i=[];c.value.forEach(function(v,I){var m={itemLabel:c.itemLabel||"{i18n>BASE_EDITOR.ARRAY.ITEM_LABEL}",index:I,total:c.value.length,properties:Object.keys(c.template).map(function(k){var t=c.template[k];var p=I+"/"+t.path;return _({},t,{path:p,value:O.get(p.split("/"),this.getValue())});},this)};i.push(m);},this);this._itemsModel.setData(i);}return r;};A.prototype._removeItem=function(e){var i=e.getSource().data("index");var v=(this.getValue()||[]).slice();v.splice(i,1);this.firePropertyChange(v);};A.prototype._addItem=function(){var c=this.getConfig();var v=(this.getValue()||[]).slice();var D={};Object.keys(c.template).forEach(function(k){var p=c.template[k];if(p.hasOwnProperty("defaultValue")){var a=p.defaultValue;D[k]=d(a);}else if(p.type==="array"){D[k]=[];}});v.push(D);this.firePropertyChange(v);};A.prototype._moveUp=function(e){var i=e.getSource().data("index");if(i>0){var v=this.getValue().slice();var r=v.splice(i,1)[0];v.splice(i-1,0,r);this.firePropertyChange(v);}};A.prototype._moveDown=function(e){var i=e.getSource().data("index");var v=this.getValue().slice();if(i<v.length-1){var r=v.splice(i,1)[0];v.splice(i+1,0,r);this.firePropertyChange(v);}};A.prototype._propertyEditorsChange=function(e){e.getParameter("previousPropertyEditors").forEach(function(p){p.detachPropertyChange(this._onPropertyValueChange,this);},this);e.getParameter("propertyEditors").forEach(function(p){p.attachPropertyChange(this._onPropertyValueChange,this);},this);};A.prototype._onPropertyValueChange=function(e){var E=(this.getValue()||[]).slice();var p=e.getParameter("path");var P=p.split("/");var v=e.getParameter("value");O.set(P,v,E);this.firePropertyChange(E);};return A;});
