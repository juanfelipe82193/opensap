/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/documentation/sdk/controller/BaseController","sap/ui/thirdparty/URI"],function(B,U){"use strict";return B.extend("sap.ui.documentation.sdk.controller.SampleBaseController",{_aMockFiles:["products.json","supplier.json","img.json"],fetchSourceFile:function(r,f){var t=this,u=r+"/"+f,s=function(a){t._codeCache[u]=a;},e=function(a){t._codeCache[u]="not found: '"+u+"'";};if(!(u in this._codeCache)){this._codeCache[u]="";jQuery.ajax(u,{async:false,dataType:"text",success:s,error:e});}return t._codeCache[u];},onDownload:function(){sap.ui.require(["sap/ui/thirdparty/jszip","sap/ui/core/util/File"],function(J,F){var z=new J();var d=this.oModel.getData();for(var i=0;i<d.files.length;i++){var f=d.files[i],r=f.raw;if(f.name&&(f.name===d.iframe||f.name.split(".").pop()==="html")){r=this._changeIframeBootstrapToCloud(r);}z.file(f.name,r);for(var j=0;j<this._aMockFiles.length;j++){var m=this._aMockFiles[j];if(f.raw.indexOf(m)>-1){z.file("mockdata/"+m,this.downloadMockFile(m));}}}var R=sap.ui.require.toUrl((this._sId).replace(/\./g,"/")),e=d.includeInDownload||[],t=this,h;if(!d.iframe){d.files.forEach(function(f){h=f.name==="manifest.json";return;});z.file("Component.js",this.fetchSourceFile(R,"Component.js"));z.file("index.html",this._changeIframeBootstrapToCloud(this._createIndexHtmlFile(d,h)));if(!h){z.file("index.js",this._changeIframeBootstrapToCloud(this._createIndexJsFile(d)));}}e.forEach(function(s){z.file(s,t.fetchSourceFile(R,s));});
// add generic license and notice file
z.file("LICENSE.txt",this.fetchSourceFile(sap.ui.require.toUrl("sap/ui/documentation/sdk/tmpl/"),"LICENSE.txt"));z.file("NOTICE.txt",this.fetchSourceFile(sap.ui.require.toUrl("sap/ui/documentation/sdk/tmpl/"),"NOTICE.txt"));var c=z.generate({type:"blob"});F.save(c,this._sId,"zip","application/zip");}.bind(this));},_createIndexHtmlFile:function(d,h){var r=sap.ui.require.toUrl("sap/ui/documentation/sdk/tmpl"),f;f=this.fetchSourceFile(r,h?"indexevo.html.tmpl":"index.html.tmpl");f=f.replace(/{{TITLE}}/g,d.name).replace(/{{SAMPLE_ID}}/g,d.id);return f;},_createIndexJsFile:function(d){var r=sap.ui.require.toUrl("sap/ui/documentation/sdk/tmpl"),f=this.fetchSourceFile(r,"index.js.tmpl");f=f.replace(/{{TITLE}}/g,d.name).replace(/{{SAMPLE_ID}}/g,d.id).replace(/{{HEIGHT}}/g,d.stretch?'height : "100%", ':"").replace(/{{SCROLLING}}/g,!d.stretch);return f;},downloadMockFile:function(f){var r=sap.ui.require.toUrl("sap/ui/demo/mock"),w="test-resources/sap/ui/documentation/sdk/images/",c="https://openui5.hana.ondemand.com/test-resources/sap/ui/documentation/sdk/images/",R=new RegExp(w,"g"),m=this.fetchSourceFile(r,f);if(m){m=m.replace(R,c);}return m;},_changeIframeBootstrapToCloud:function(r){var a=/src=(?:"[^"]*\/sap-ui-core\.js"|'[^']*\/sap-ui-core\.js')/,c=new U(window.location.href).search(""),R=new U(sap.ui.require.toUrl("")+"/sap-ui-core.js"),b=R.absoluteTo(c).toString();return r.replace(a,'src="'+b+'"');}});});
