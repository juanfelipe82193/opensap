/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/library','sap/m/library','sap/ui/core/Core','sap/base/Log','sap/base/util/uid','sap/ui/core/Item','sap/ui/core/syncStyleClass','sap/ui/model/json/JSONModel','sap/m/Button','sap/m/CheckBox','sap/m/Dialog','sap/m/Input','sap/m/Label','sap/m/Select','sap/m/Text','sap/m/VBox'],function(c,l,C,L,u,I,s,J,B,a,D,b,d,S,T,V){'use strict';var e=l.ButtonType;var f=c.ValueState;var r=C.getLibraryResourceBundle('sap.ui.export',true);function g(o,R){var h={fileName:'Standard',fileType:[{key:'xlsx'}],selectedFileType:'xlsx',splitCells:false,includeFilterSettings:false,addDateTime:false};var E=Object.assign({},h,o||{});for(var i=0;i<E.fileType.length;i++){var j;if(!E.fileType[i].text){E.fileType[i].text=R.getText(E.fileType[i].key.toUpperCase()+'_FILETYPE');}if(E.fileType[i].key===E.selectedFileType){j=E.fileType[i].key;}}if(!j){E.selectedFileType=E.fileType[0].key;}return E;}var U={_INTERCEPTSERVICE:'sap/ushell/cloudServices/interceptor/InterceptService',interceptUrl:function(h){var i=sap.ui.require(U._INTERCEPTSERVICE);if(i){var o=i.getInstance();if(o&&o.interceptUrl){h=o.interceptUrl(h);}}return h;},getExportSettingsViaDialog:function(m,o,h){return new Promise(function(R,i){var E;r.then(function(j){var k=new J();k.setData(g(m,j));var n=u();E=new D({id:n,title:j.getText('EXPORT_SETTINGS_TITLE'),horizontalScrolling:false,verticalScrolling:false,content:[new V({renderType:'Bare',width:'100%',items:[new d({text:j.getText('FILE_NAME'),labelFor:n+'-fileName'}),new b({id:n+'-fileName',value:'{/fileName}',liveChange:function(p){var q=p.getSource();var F=p.getParameter('value');var t=/[\\/:|?"*<>]/;var v=C.byId(n+'-export');var w=t.test(F);if(w){q.setValueState(f.Error);q.setValueStateText(j.getText('FILENAME_ERROR'));}else if(F.length>100){q.setValueState(f.Warning);q.setValueStateText(j.getText('FILENAME_WARNING'));}else{q.setValueState(f.None);q.setValueStateText(null);}v.setEnabled(!w);}}).addStyleClass('sapUiTinyMarginBottom'),new d({text:j.getText('SELECT_FORMAT'),labelFor:n+'-fileType',visible:false}),new S({id:n+'-fileType',width:'100%',selectedKey:'{/selectedFileType}',visible:false,items:{path:'/fileType',template:new I({key:'{key}',text:'{text}'})}}),new a({id:n+'-splitCells',selected:'{/splitCells}',text:j.getText('SPLIT_CELLS')}),new a({id:n+'-includeFilterSettings',selected:'{/includeFilterSettings}',text:j.getText('INCLUDE_FILTER_SETTINGS')}),new a({id:n+'-addDateTime',selected:'{/addDateTime}',text:j.getText('ADD_DATE_TIME'),visible:false})]}).addStyleClass('sapUiExportSettingsLabel')],endButton:new B({id:n+'-cancel',text:j.getText('CANCEL_BUTTON'),press:function(){E.close();}}),beginButton:new B({id:n+'-export',text:j.getText('EXPORT_BUTTON'),type:e.Emphasized,press:function(){if(E){E._bSuccess=true;E.close();R(k.getData());}}}),afterClose:function(){if(!E._bSuccess){i(null);}E.destroy();E=null;}});E.addStyleClass('sapUiContentPadding sapUiExportSettings');E.setModel(k);if(o){s('sapUiSizeCompact',o,E);}E.open();if(h){h(E);}});});},_getReadableFilterValue:function(F){switch(F.op||F.name){case'==':return'='+F.right.value;case'>':case'<':case'!=':case'<=':case'>=':return F.op+F.right.value;case'between':return F.args[1].value+'...'+F.args[2].value;case'contains':return'*'+F.args[1].value+'*';case'endswith':return'*'+F.args[1].value;case'startswith':return F.args[1].value+'*';default:throw Error('getReadableFilter');}},_parseFilter:function(F){switch(F.type){case'Logical':return U._parseLogical(F);case'Binary':return U._parseBinary(F);case'Unary':return U._parseUnary(F);case'Call':return U._parseCall(F);default:throw Error('Filter type '+F.type+' not supported');}},_parseLogical:function(o){if(o.op=='&&'&&o.left.type==='Binary'&&o.right.type==='Binary'&&o.left.op==='>='&&o.right.op==='<='&&o.left.left.path===o.right.left.path){return U._parseCall({args:[{path:o.left.left.path,type:'Reference'},{type:'Literal',value:o.left.right.value},{type:'Literal',value:o.right.right.value}],name:'between',type:'Call'});}return U._parseFilter(o.left).concat(U._parseFilter(o.right));},_parseBinary:function(o){if(!o.left||o.left.type!='Reference'||!o.right||o.right.type!='Literal'){return[];}return[{key:o.left.path,value:U._getReadableFilterValue(o)}];},_parseUnary:function(o){var h;if(!o.arg){return[];}h=U._parseFilter(o.arg);h[0].value='!'+h[0].value;return h;},_parseCall:function(o){if(!o.args||o.args.length<2){return[];}return[{key:o.args[0].path,value:U._getReadableFilterValue(o)}];},parseFilterConfiguration:function(o,h){return new Promise(function(R,i){r.then(function(j){var F,k;F={name:j.getText('FILTER_HEADER'),items:[]};if(!o||!(o.isA('sap.ui.model.ListBinding')||o.isA('sap.ui.model.TreeBinding'))){L.error('A ListBinding is required for parsing the filter settings');i();return null;}var m=o.getFilterInfo();if(m){F.items=U._parseFilter(m);}if(typeof h==='function'){F.items.forEach(function(n){k=h(n.key);n.key=k&&typeof k==='string'?k:n.key;});}R(F);});});},getAvailableCloudExportTargets:function(){var h=U.getCloudExportService();return h.then(function(i){return i&&i.getSupportedTargets?i.getSupportedTargets():[];}).catch(function(){return[];});},getCloudExportService:function(){return sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getServiceAsync?sap.ushell.Container.getServiceAsync('ProductivityIntegration'):Promise.reject();},saveAsFile:function(o,F){var h,i,j;if(!(o instanceof Blob)){return;}h=document.createElementNS('http://www.w3.org/1999/xhtml','a');i='download'in h;if(i){j=function(k,m){h.download=m;h.href=URL.createObjectURL(k);h.dispatchEvent(new MouseEvent('click'));};}if(typeof j==='undefined'){j=function(k){var m=new FileReader();m.onloadend=function(){var n,p;p=m.result.replace(/^data:[^;]*;/,'data:attachment/file;');n=window.open(p,'_blank');if(!n){window.location.href=p;}};m.readAsDataURL(k);};}if(typeof navigator!=='undefined'&&navigator.msSaveOrOpenBlob){j=function(k,m){window.navigator.msSaveOrOpenBlob(k,m);};}j(o,F);}};return U;},true);
