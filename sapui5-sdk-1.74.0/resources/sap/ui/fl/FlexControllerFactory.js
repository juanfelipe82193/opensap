/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/FlexController","sap/ui/fl/Utils","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/variants/VariantModel","sap/base/Log","sap/ui/performance/Measurement"],function(F,U,A,a,V,L,M){"use strict";var b={};b._instanceCache={};b.create=function(c,s){s=s||U.DEFAULT_APP_VERSION;if(!b._instanceCache[c]){b._instanceCache[c]={};}var f=b._instanceCache[c][s];if(!f){f=new F(c,s);b._instanceCache[c][s]=f;}return f;};b.createForControl=function(c,m){try{var o=U.getAppComponentForControl(c);var C=U.getComponentClassName(o||c);var s=U.getAppVersionFromManifest(o?o.getManifest():m);return b.create(C,s);}catch(e){L.error(e.message,undefined,"sap.ui.fl.FlexControllerFactory");}};b.getChangesAndPropagate=function(c,C){if(U.isApplicationComponent(c)){return a.initialize({componentId:C.id||c.getId(),asyncHints:C.asyncHints}).then(_.bind(this,c));}else if(U.isEmbeddedComponent(c)){var o=U.getAppComponentForControl(c);if(o){return Promise.resolve().then(function(){var e=o.getModel(U.VARIANT_MODEL_NAME);if(!e){return _(o);}return e;}).then(function(v){c.setModel(v,U.VARIANT_MODEL_NAME);});}}};function _(o){var m=o.getManifestObject();var f;f=b.createForControl(o,m);return f._oChangePersistence.loadChangesMapForComponent(o).then(function(g){var p=A.applyAllChangesForControl.bind(A,g,o,f);p._bIsSapUiFlFlexControllerApplyChangesOnControl=true;o.addPropagationListener(p);var d=f.getVariantModelData()||{};var v=new V(d,f,o);o.setModel(v,U.VARIANT_MODEL_NAME);M.end("flexProcessing");return v;});}return b;},true);
