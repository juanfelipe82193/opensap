/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/security/encodeURLParameters","sap/base/Log"],function(e,L){"use strict";return{logAndResolveDefault:function(r,c,f,E){L.error("Connector ("+c.connector+") failed call '"+f+"': "+E);return r;},getUrl:function(r,p,P){if(!r||!p.url){throw new Error("Not all necessary parameters were passed");}var u=p.url+r;if(p.cacheKey){u+="~"+p.cacheKey+"~/";}if(p.reference){u+=p.reference;}else if(p.fileName){u+=p.fileName;}if(P){Object.keys(P).forEach(function(k){if(P[k]===undefined){delete P[k];}});var q=e(P);if(q.length>0){u+="?"+q;}}return u;},sendRequest:function(u,m,p){m=m||"GET";m=m.toUpperCase();return new Promise(function(r,a){var x=new XMLHttpRequest();x.open(m,u);if((m==="GET"||m==="HEAD")&&(!p||!p.xsrfToken)){x.setRequestHeader("X-CSRF-Token","fetch");}if((m==="POST"||m==="PUT"||m==="DELETE")&&p&&p.xsrfToken){x.setRequestHeader("X-CSRF-Token",p.xsrfToken);}if(p&&p.contentType){x.setRequestHeader("Content-Type",p.contentType);}if(p&&p.siteId){x.setRequestHeader("X-LRep-Site-Id",p.siteId);}if(p&&p.sAppDescriptorId){x.setRequestHeader("X-LRep-AppDescriptor-Id",p.sAppDescriptorId);}if(p&&p.dataType){x.responseType=p.dataType;}if(p&&p.payload){x.send(p.payload);}else{x.send();}x.onload=function(){if(x.status>=200&&x.status<400){var R={};if(x.status!==204){if(!x.response&&x.responseText){x.response=x.responseText;}if(x.response){R.response=typeof x.response==="string"?JSON.parse(x.response):x.response;}}R.status=x.status;if(x.getResponseHeader("X-CSRF-Token")){R.xsrfToken=x.getResponseHeader("X-CSRF-Token");}r(R);}else{a({status:x.status,message:x.statusText});}};});}};});
