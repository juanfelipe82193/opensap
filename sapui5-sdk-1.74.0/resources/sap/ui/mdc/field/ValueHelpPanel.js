/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/XMLComposite","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/base/ManagedObjectObserver","sap/base/strings/formatMessage","sap/ui/model/resource/ResourceModel","sap/m/Tokenizer"],function(X,J,F,M,f,R,T){"use strict";var V=X.extend("sap.ui.mdc.field.ValueHelpPanel",{metadata:{properties:{showTokenizer:{type:"boolean",group:"Data",defaultValue:true},showFilterbar:{type:"boolean",group:"Data",defaultValue:true},conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},filterConditions:{type:"object[]",group:"Data",defaultValue:[]},searchEnabled:{type:"boolean",group:"Data",defaultValue:true},formatOptions:{type:"object",defaultValue:{}},_filterBarVisible:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"}},events:{search:{}}},fragment:"sap.ui.mdc.field.ValueHelpPanel",init:function(){var m=this._getManagedObjectModel();m.setSizeLimit(1000000);if(!this._oTokenizer){this._oTokenizer=this.byId("VHPTokenizer");this._oTokenizer.updateTokens=function(){T.prototype.updateTokens.apply(this,arguments);this.invalidate();};this._oTokenizer._oScroller.setHorizontal(false);this._oTokenizer._oScroller.setVertical(true);}this._oTokenizerPanel=this.byId("VHPTokenizerPanel");var s=this.byId("SearchField");s.getFieldPath=a.bind(this);this._oAdvButton=this.byId("AdvancedFilter");this._oFilterSplitter=this.byId("filterbarSplitter");this._oFilterSplitter._oValueHelpPanel=this;this._oFilterSplitter.getContentAreasOriginal=this._oFilterSplitter.getContentAreas;this._oFilterSplitter.getContentAreas=function(){var c=[];if(this._oValueHelpPanel._oFilterbar&&this._oValueHelpPanel.getProperty("_filterBarVisible")){c=this.getContentAreasOriginal();}if(this._oValueHelpPanel._oTable){c.push(this._oValueHelpPanel._oTable);}return c;};this._oFilterVBox=this.byId("filterbarVBox");this._oFilterVBox._oValueHelpPanel=this;this._oFilterVBox.getItemsOriginal=this._oFilterVBox.getItems;this._oFilterVBox.getItems=function(){var i=this.getItemsOriginal();if(this._oValueHelpPanel._oFilterbar&&this._oValueHelpPanel.getProperty("_filterBarVisible")){i.push(this._oValueHelpPanel._oFilterbar);}return i;};this._oObserver=new M(_.bind(this));this._oObserver.observe(this,{properties:["formatOptions","showFilterbar","showTokenizer","_filterBarVisible"]});this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");},exit:function(){if(!this.getShowTokenizer()){this._oTokenizerPanel.destroy();}if(this._oDefineConditionPanel&&!this._oDefineConditionPanel.getParent()){this._oDefineConditionPanel.destroy();}this._oObserver.disconnect();this._oObserver=undefined;},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");}},setFilterbar:function(o){var s=this.getShowFilterbar();if(this._oFilterbar){this._oFilterbar.removeStyleClass("sapMdcValueHelpPanelFilterbar");if(this._bFilterbarParentSet){this._oFilterbar.setParent();delete this._bFilterbarParentSet;}}this._oFilterbar=o;if(o){o.addStyleClass("sapMdcValueHelpPanelFilterbar");if(!o.getParent()){o.setParent(this);this._bFilterbarParentSet=true;}o.getParent().getDirection=this._oFilterVBox.getDirection.bind(this._oFilterVBox);}var i=this.byId("iconTabBar");i.getItems()[0].setVisible(i.getItems()[0].getContent().length>0);i.setSelectedKey("selectFromList");this._updateITBHeaderVisiblity();this.setProperty("_filterBarVisible",s&&!!this._oFilterbar,true);},setTable:function(t){if(this._oTable){if(this._bTableParentSet&&this._oTable.getParent()){this._oTable.setParent();}delete this._bTableParentSet;}this._oTable=t;if(t){t.setLayoutData(new sap.ui.layout.SplitterLayoutData({size:"auto"}));if(!t.getParent()){t.setParent(this);this._bTableParentSet=true;}}this._oFilterSplitter.invalidate();var i=this.byId("iconTabBar");i.getItems()[0].setVisible(i.getItems()[0].getContent().length>0);i.setSelectedKey("selectFromList");this._updateITBHeaderVisiblity();},getTable:function(){if(this._oTable){return this._oTable;}else{return undefined;}},setDefineConditions:function(d){var i=this.byId("iconTabBar");if(this._oDefineConditionPanel){i.getItems()[1].removeContent(this._oDefineConditionPanel);this._oDefineConditionPanel.destroy();}this._oDefineConditionPanel=d;i.getItems()[1].setVisible(!!this._oDefineConditionPanel);this._updateITBHeaderVisiblity();},_updateITBHeaderVisiblity:function(){var i=this.byId("iconTabBar");if(i.getItems()[0].getVisible()&&i.getItems()[1].getVisible()){i.removeStyleClass("sapMdcNoHeader");}else{i.addStyleClass("sapMdcNoHeader");}if(i.getItems()[1].getVisible()&&i.getSelectedKey()!=="selectFromList"){b.call(this);}},_handleTokenUpdate:function(e){if(e.getParameter("type")==="removed"){var r=e.getParameter("removedTokens");var c=this.getConditions();var i;for(i=0;i<r.length;i++){var o=r[i];var p=o.getBindingContext("$this").sPath;var I=parseInt(p.slice(p.lastIndexOf("/")+1));c[I].delete=true;}for(i=c.length-1;i>=0;i--){if(c[i].delete){c.splice(i,1);}}this.setProperty("conditions",c,true);}},_handleCloseFilterbar:function(e){this._oAdvButton.setPressed(false);this._oAdvButton.focus();},iconTabSelect:function(e){var k=e.getParameter("key");if(k==="defineCondition"){b.call(this);}},_formatListTabTitle:function(t,c){var C=0;for(var i=0;i<c.length;i++){var o=c[i];if(o.isEmpty!==true&&o.operator==="EEQ"){C++;}}if(C===0){t=this._oResourceBundle.getText("valuehelp.SELECTFROMLISTNONUMBER");}return f(t,C);},_formatDefineTabTitle:function(t,c){var C=0;for(var i=0;i<c.length;i++){var o=c[i];if(o.isEmpty!==true&&o.operator!=="EEQ"){C++;}}if(C===0){t=this._oResourceBundle.getText("valuehelp.DEFINECONDITIONSNONUMBER");}return f(t,C);},_formatTokenizerTitle:function(t,c){var C=0;for(var i=0;i<c.length;i++){var o=c[i];if(o.isEmpty!==true){C++;}}if(C===0){t=this._oResourceBundle.getText("valuehelp.TOKENIZERTITLENONUMBER");}return f(t,C);},_handleSearch:function(e){this.fireSearch();}});function _(c){if(c.name==="formatOptions"){var B=this._oTokenizer.getBindingInfo("tokens");if(B&&B.template){B=B.template.getBindingInfo("text");if(B&&B.type){B.type.setFormatOptions(c.current);}}}if(c.name==="showTokenizer"){var s=this.byId("rootSplitter");var l=this._oTokenizer.getBinding("tokens");if(c.current){l.resume();s.insertContentArea(this._oTokenizerPanel,1);}else{l.suspend();s.removeContentArea(this._oTokenizerPanel);}}if(c.name==="showFilterbar"){this.setProperty("_filterBarVisible",c.current&&!!this._oFilterbar,true);}if(c.name==="_filterBarVisible"){this._oFilterSplitter.invalidate();}}function a(){var B=this.getBindingPath("filterConditions");if(B&&B.startsWith("/conditions/")){return B.slice(12);}else{return"";}}function b(){if(this._oDefineConditionPanel){if(!this._oDefineConditionPanel.getModel("$VHP")){var m=this._getManagedObjectModel();this._oDefineConditionPanel.setModel(m,"$VHP");var o=this._oDefineConditionPanel.getMetadata();if(o.hasProperty("formatOptions")&&!this._oDefineConditionPanel.getBindingPath("formatOptions")&&this._oDefineConditionPanel.isPropertyInitial("formatOptions")){this._oDefineConditionPanel.bindProperty("formatOptions",{path:"$VHP>/formatOptions"});}if(o.hasProperty("conditions")&&!this._oDefineConditionPanel.getBindingPath("conditions")&&this._oDefineConditionPanel.isPropertyInitial("conditions")){this._oDefineConditionPanel.bindProperty("conditions",{path:"$VHP>/conditions"});}}var i=this.byId("iconTabBar");i.getItems()[1].addContent(this._oDefineConditionPanel);}}return V;});
