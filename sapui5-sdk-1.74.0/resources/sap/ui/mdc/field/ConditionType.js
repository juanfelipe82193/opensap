/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/ui/model/type/String','sap/ui/mdc/library','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Condition','sap/ui/mdc/util/BaseType','sap/base/util/merge'],function(S,F,P,V,a,l,b,C,B,m){"use strict";var c=l.FieldDisplay;var d=S.extend("sap.ui.mdc.field.ConditionType",{constructor:function(x,y){S.apply(this,arguments);this.sName="Condition";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}});d.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}this._bDestroyed=true;};d.prototype.formatValue=function(x,I){if(x==undefined||x==null||this._bDestroyed){return null;}if(typeof x!=="object"||!x.operator||!x.values||!Array.isArray(x.values)){throw new F("No valid condition provided");}if(!I){I="string";}var T=n.call(this);var O=o.call(this);var y=p.call(this);var z=this.oFormatOptions.isUnit;s.call(this,x,O);if(z){x=m({},x);if(x.values[0]&&Array.isArray(x.values[0])){x.values[0]=x.values[0][1];}if(x.operator!=="EQ"&&x.operator!=="EEQ"){x.operator="EQ";if(x.values[1]){x.values.splice(1,1);}}}s.call(this,x,T);switch(this.getPrimitiveType(I)){case"string":case"any":if(x.operator==="EQ"&&(b.onlyEEQ(y)||w.call(this,T)==="boolean")){x=m({},x);x.operator="EEQ";}var D=k.call(this);var A=q.call(this);if(x.operator==="EEQ"&&D!==c.Value&&!x.values[1]&&A){var E=function(K){if(K instanceof F&&!A.getValidateInput()){return x;}else{throw K;}};var G=function(J){x=m({},x);if(J&&typeof J==="object"){x=u.call(this,x,J);}else if(x.values.length===1){x.values.push(J);}else{x.values[1]=J;}return x;};var H=this.oFormatOptions.bindingContext;var J;try{J=A.getTextForKey(x.values[0],x.inParameters,x.outParameters,H);}catch(K){return E.call(this,K);}if(J instanceof Promise){return J.then(function(J){x=G.call(this,J);return _.call(this,x);}.bind(this)).catch(function(K){x=E.call(this,K);return _.call(this,x);}.bind(this));}else{x=G.call(this,J);}}return _.call(this,x);default:if(T&&x.values.length>=1){return T.formatValue(x.values[0],I);}throw new F("Don't know how to format Condition to "+I);}};function _(x){var D=k.call(this);var T=n.call(this);if(this.oFormatOptions.hideOperator&&x.values.length>=1){return T.formatValue(x.values[0],"string");}var O=b.getOperator(x.operator);return O.format(x.values,x,T,D);}d.prototype.parseValue=function(x,I){if(this._bDestroyed){return null;}if(!I){I="string";}else if(I==="any"&&typeof x==="string"){I="string";}var N=this.oFormatOptions.navigateCondition;if(N){var O=this.formatValue(N,I);if(O===x){return m({},N);}}var D=k.call(this);var y=q.call(this);var T=n.call(this);var z=o.call(this);var A=p.call(this);var E=this.oFormatOptions.isUnit;var G;if(x===null||x===undefined||(x===""&&!y)){if(!r.call(this,T)&&!E){return null;}}t.call(this,T);t.call(this,z);switch(this.getPrimitiveType(I)){case"string":var H=x;var J;var K=false;if(b.onlyEEQ(A)){J=b.getEEQOperator();if(!J.test(x,T)){H="=="+x;}}else{var M=b.getMatchingOperators(A,H);if(M.length===0){if(y&&!r.call(this,T)){J=b.getEEQOperator();if(!J.test(x,T)){H="=="+x;}K=true;}else{J=b.getDefaultOperator(w.call(this,T));H=J?J.format([x]):x;}}else{J=M[0];}}if(J){var L;try{L=J.getCondition(H,T,D);}catch(Q){if(Q instanceof P&&z){z.parseValue(x,"string",z._aCurrentValue);}throw Q;}if(!L){throw new P("Cannot parse value "+x);}if(!r.call(this,T)){if(J.name==="EEQ"&&y){if(L.values[0]!==null&&L.values[0]!==undefined){L=f.call(this,L,T,y,K,A,x,D);if(L instanceof Promise){return v.call(this,L);}}else if(L.values[1]!==null&&L.values[1]!==undefined){L=g.call(this,L,T,y,true,K,A,x,D);if(L instanceof Promise){return v.call(this,L);}}else if(x===""){L=null;}}else if(x===""){L=null;}}return e.call(this,L,T);}throw new P("Cannot parse value "+x);default:if(T){if(b.onlyEEQ(A)){G="EEQ";}else{G=b.getDefaultOperator(w.call(this,T)).name;}return C.createCondition(G,[T.parseValue(x,I)]);}throw new P("Don't know how to parse Condition from "+I);}};function e(x,T){var I=this.oFormatOptions.isUnit;var O=o.call(this);var U=null;if(I){var M;if(O._aCurrentValue){M=O._aCurrentValue[0];}if(x){if(x.operator!=="EEQ"&&x.operator!=="EQ"){throw new P("unsupported operator");}U=x.values[0];x.values=[[M,U],undefined];}else{x=C.createCondition("EEQ",[[M,null],undefined]);}s.call(this,x,O);}else if(x){var N=T.getMetadata().getName();var D=this.oFormatOptions.delegate;var y=this.oFormatOptions.payload;if(D&&D.getBaseType(y,N)===B.Unit&&!x.values[0][1]&&T._aCurrentValue){U=T._aCurrentValue[1]?T._aCurrentValue[1]:null;x.values[0][1]=U;if(x.operator==="BT"){x.values[1][1]=U;}}s.call(this,x,T);s.call(this,x,O);}return x;}function f(x,T,y,z,O,A,D){var E;var G=function(J){if(J&&!(J instanceof P)&&!(J instanceof F)&&!(J instanceof V)){throw J;}if(D===c.Value){if(z){return i.call(this,T,O,A,D);}else if(!y.getValidateInput()){return j.call(this,T,O,A,D);}else{throw new P(J.message);}}else{x.values[1]=x.values[0];x.values[0]=null;return g.call(this,x,T,y,false,z,O,A,D);}};var H=function(E){if(E){if(typeof E==="object"){x=u.call(this,x,E);}else{x.values[1]=E;}}else{if(A===""){x=null;}else{x=G.call(this,new P(this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[A])));}}return x;};try{T.validateValue(x.values[0]);var I=this.oFormatOptions.bindingContext;E=y.getTextForKey(x.values[0],undefined,undefined,I);}catch(J){return G.call(this,J);}if(E instanceof Promise){return E.then(function(E){x=H.call(this,E);return e.call(this,x,T);}.bind(this)).catch(function(J){x=G.call(this,J);return e.call(this,x,T);}.bind(this));}else{return H.call(this,E);}}function g(x,T,y,z,A,O,D,E){if(x.values[1]===""){return h.call(this,x,T,y,z,A,O,D,E,undefined);}var G=function(J){if(J&&!(J instanceof P)&&!(J instanceof F)){throw J;}if(J._bNotUnique){if(!y.getValidateInput()){return j.call(this,T,O,D,E);}else{throw J;}}else{return h.call(this,x,T,y,z,A,O,D,E,J);}};var H=function(K){if(K===null||K===undefined){return h.call(this,x,T,y,z,A,O,D,E,undefined);}if(K&&typeof K==="object"){x=u.call(this,x,K);}else{x.values[0]=K;}return x;};var I=this.oFormatOptions.bindingContext;var K;try{K=y.getKeyForText(x.values[1],I);}catch(J){return G.call(this,J);}if(K instanceof Promise){return K.then(function(K){x=H.call(this,K);return z?e.call(this,x,T):x;}.bind(this)).catch(function(J){x=G.call(this,J);return z?e.call(this,x,T):x;}.bind(this));}else{return H.call(this,K);}}function h(x,T,y,z,A,O,D,E,G){var H=null;var I=function(G){if(G&&!(G instanceof P)&&!(G instanceof F)){throw G;}x.values[1]=null;if(A){return i.call(this,T,O,D,E);}else if(!y.getValidateInput()){return j.call(this,T,O,D,E);}throw new P(G.message);};var J=function(H){if(H){if(typeof H==="object"){x=u.call(this,x,H);}else{x.values[1]=H;}}else{if(D===""){x=null;}else{x=I.call(this,G||new P(this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[D])));}}return x;};try{x.values[0]=T.parseValue(x.values[1],"string");T.validateValue(x.values[0]);}catch(M){z=false;}if(z){var K=this.oFormatOptions.bindingContext;try{H=y.getTextForKey(x.values[0],undefined,undefined,K);}catch(M){return I.call(this,M);}if(H instanceof Promise){return H.then(function(H){return J.call(this,H);}.bind(this)).catch(function(G){return I.call(this,G);}.bind(this));}}else if(G){return I.call(this,G);}return J.call(this,H);}function i(T,O,x,D){var y=b.getDefaultOperator(w.call(this,T));var z=y?y.format([x]):x;var A=y.getCondition(z,T,D);return A;}function j(T,O,x,D){var y;if(b.onlyEEQ(O)){y="EEQ";}else{if(x.startsWith("==")){y="EEQ";x=x.slice(2);}else if(x.startsWith("=")){y="EQ";x=x.slice(1);}}var z=T.parseValue(x,"string");var A=C.createCondition(y,[z]);return A;}d.prototype.validateValue=function(x){var T=n.call(this);var O=p.call(this);var I=this.oFormatOptions.isUnit;if(x===undefined||this._bDestroyed){return null;}else if(x===null){if(b.onlyEEQ(O)){try{if(T._sParsedEmptyString===""){T.validateValue("");}else{T.validateValue(null);}}catch(E){if(E instanceof V){throw E;}else{return null;}}}return null;}if(typeof x!=="object"||!x.operator||!x.values||!Array.isArray(x.values)){throw new V(this._oResourceBundle.getText("field.VALUE_NOT_VALID"));}var y=b.getOperator(x.operator,O);if(I){x=m({},x);if(x.values[0]&&Array.isArray(x.values[0])){x.values[0]=x.values[0][1];}y=b.getEEQOperator();}y.validate(x.values,T);};function k(){var D=this.oFormatOptions.display;if(!D){D=c.Value;}return D;}function n(){var T=this.oFormatOptions.valueType;if(!T){if(!this._oDefaultType){this._oDefaultType=new a();}T=this._oDefaultType;}return T;}function o(){return this.oFormatOptions.originalDateType;}function p(){var O=this.oFormatOptions.operators;if(!O||O.length===0){O=b.getOperatorsForType(B.String);}return O;}function q(){var I=this.oFormatOptions.fieldHelpID;if(I){return sap.ui.getCore().byId(I);}return null;}function r(T){return T&&T.isA("sap.ui.model.CompositeType");}function s(x,T){if(r.call(this,T)&&x&&x.values[0]){T._aCurrentValue=x.values[0];}}function t(T){if(r.call(this,T)&&!T._aCurrentValue){T._aCurrentValue=[];}}function u(x,R){x.values=[R.key,R.description];if(R.inParameters){x.inParameters=R.inParameters;}if(R.outParameters){x.outParameters=R.outParameters;}return x;}function v(x){if(this.oFormatOptions.asyncParsing){this.oFormatOptions.asyncParsing(x);}return x;}function w(T){var x=T.getMetadata().getName();var y=T.oFormatOptions;var z=T.oConstraints;var D=this.oFormatOptions.delegate;var A=this.oFormatOptions.payload;var E=D?D.getBaseType(A,x,y,z):B.String;if(E===B.Unit){E=B.Numeric;}return E;}return d;});
