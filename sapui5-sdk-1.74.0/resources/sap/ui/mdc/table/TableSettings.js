/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/p13n/Util","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarLayoutData","sap/base/util/merge"],function(U,O,a,m){"use strict";var r;var T={createSortButton:function(i,e){if(!r){this._loadResourceBundle();}return this._createButton(i+"-sort",{icon:"sap-icon://sort",text:r.getText("table.SETTINGS_SORT","Sort"),press:e,tooltip:r.getText("table.SETTINGS_SORT","Sort"),layoutData:new a({closeOverflowOnInteraction:false})});},createColumnsButton:function(i,e){if(!r){this._loadResourceBundle();}return this._createButton(i+"-settings",{icon:"sap-icon://action-settings",text:r.getText("table.SETTINGS_COLUMN","Add/Remove Columns"),press:e,tooltip:r.getText("table.SETTINGS_COLUMN","Add/Remove Columns"),layoutData:new a({closeOverflowOnInteraction:false})});},_createButton:function(i,s){return new O(i,s);},_loadResourceBundle:function(){r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");},showPanel:function(c,p,s,i){return new Promise(function(b,d){T["_getP13nStateOf"+p](c).then(function(P){U["showP13n"+p](c,s,P,b);});});},_getP13nStateOfSort:function(c){return new Promise(function(b){sap.ui.require([this.getDelegate().name],function(D){if(!D||!D.fetchProperties||!D.getCurrentState){return b([]);}var p={};p.items=[];var e=m({},D.getCurrentState(this).sorters);Object.keys(e).forEach(function(n,C){e[n].index=C;});D.fetchProperties(this).then(function(P){P.forEach(function(o){var d=e[o.name]?true:false;if(o.sortable){p.items.push({name:o.name,label:o.label||o.name,descending:d?e[o.name].descending:null,selected:d,groupLabel:o.groupLabel,position:d?e[o.name].index:-1});}});b(p);});}.bind(this));}.bind(c));},_getP13nStateOfColumns:function(c){return new Promise(function(b){sap.ui.require([this.getDelegate().name],function(D){var p={};p.items=[];var e=D.getCurrentState(this).visibleFields;var E=e.reduce(function(M,P,i){M[P.name]=P;M[P.name].position=i;return M;},{});D.fetchProperties(this).then(function(P){P.forEach(function(o){var d=E[o.name]?true:false;p.items.push({id:d?E[o.name].id:undefined,name:o.name,label:d?E[o.name].label||E[o.name].name:o.label||o.name,selected:d,groupLabel:o.groupLabel,position:d?E[o.name].position:-1});});b(p);});}.bind(this));}.bind(c));},createSort:function(c,p,R){sap.ui.require([c.getDelegate().name],function(D){if(!D||!D.getCurrentState){return;}var C=[],d=false;var e=D.getCurrentState(c).sorters;for(var n in e){var P=e[n];if(p===n){d=P.descending;}if(R){C.push({selectorElement:c,changeSpecificData:{changeType:"removeSort",content:{name:n,descending:P.descending}}});}}C.push({selectorElement:c,changeSpecificData:{changeType:"addSort",content:{name:p,descending:d}}});U.handleUserChanges(C);});},moveColumn:function(c,d,n){this._moveItem(c,d,n,"moveColumn");},_moveItem:function(c,d,n,M){sap.ui.require([c.getDelegate().name],function(D){if(!D||!D.getCurrentState){return;}var C=[];var v=D.getCurrentState(c).visibleFields||[];var o=v[d];C.push(U.createMoveChange(o.id,o.name,n,M,c));U.handleUserChanges(C);});}};return T;});
