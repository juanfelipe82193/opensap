/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/m/ResponsivePopover','sap/m/List','sap/m/Bar','sap/m/SearchField','sap/m/StandardListItem',"sap/ui/core/InvisibleText",'sap/m/library','sap/ui/Device','sap/ui/mdc/chart/DimensionItem'],function(R,L,B,S,c,I,M,D,d){"use strict";var P=M.PlacementType;var e=M.ListType;var f=M.ListMode;function _(C){var a=C.getAggregation("_chart").getDrillStack();var s=[];a.forEach(function(o){o.dimension.forEach(function(b){if(b!=null&&b!=""&&s.indexOf(b)==-1){s.push(b);}});});return s;}function g(p){var i=p.filter(function(o){return o.kind=="Dimension";});if(i){i.sort(function(a,b){if(a.label&&b.label){return a.label.localeCompare(b.label);}});}return i;}var h=function(){};h.createDrillDownPopover=function(C){var l=new L({mode:f.SingleSelectMaster,selectionChange:function(E){if(E&&E.mParameters&&E.mParameters.listItem){if(E.mParameters.listItem.getType()===e.Inactive){return;}var o=E.mParameters.listItem.data("dim");if(o){var m=C.DELEGATE.retrieveAggregationItem("items",o);var a=new d(m.settings);a.toChart(C.getAggregation("_chart")).then(function(b){C.addItem(a);C.getAggregation("_chart").drillDown(b.getKey());});}}p.close();}});var s=new B();var p=new R({contentWidth:"25rem",contentHeight:"20rem",placement:P.Bottom,subHeader:s});if(D.system.desktop){var i=new I({});p.setShowHeader(false);p.addContent(i);p.addAriaLabelledBy(i);}else{p.setTitle("View By");}p.addContent(l);C._oDrillDownPopover=p;};h.showDrillDownPopover=function(C){C.DELEGATE.fetchProperties(C).then(function(p){var o=C._oDrillDownPopover.getContent()[1];var a,s,b,l;o.removeAllItems();a=_(C);s=g(p);for(var i=0;i<s.length;i++){b=s[i];if(a.indexOf(b.name)>-1){continue;}l=new c({title:b.label,type:e.Active});l.data("dim",b);o.addItem(l);}C._oDrillDownPopover.openBy(C._oDrillDownBtn);});};h.createDrillBreadcrumbs=function(C){sap.ui.require(["sap/m/Breadcrumbs"],function(a){var i=C.getAggregation("_chart");var o=new a();i.attachDrilledUp(function(E){this._updateDrillBreadcrumbs();}.bind(this));i.attachDrilledDown(function(E){this._updateDrillBreadcrumbs();}.bind(this));C.setAggregation("_breadcrumbs",o);this._updateDrillBreadcrumbs(i,o);}.bind(this));};h._updateDrillBreadcrumbs=function(o,a){sap.ui.require(["sap/m/Link"],function(b){if(!a){return;}var v=o.getDrillStack();var n=[];if(v){v.reverse();v.forEach(function(l,m,p){if(l.dimension.length>0&&typeof o.getDimensionByName(l.dimension[l.dimension.length-1])!='undefined'){var s=o.getDimensionByName(l.dimension[l.dimension.length-1]).getLabel();if(m==0){a.setCurrentLocationText(s);}else{var C=new b({text:s,press:function(E){var q=a.indexOfLink(E.getSource());o.drillUp(q+1);o.fireDeselectData(E);this._updateDrillBreadcrumbs(o,a);}.bind(this)});n.push(C);}}else{if(m==0){a.setVisible(false);}}}.bind(this));}var j=a.getLinks();n.reverse();var k=false;if(j.length!==n.length){k=true;}else{for(var i=0;i<n.length;i++){if(n[i].getText()!=j[i].getText()){k=true;break;}}}if(k){if(a.getLinks()){a.removeAllLinks();}for(var i=0;i<n.length;i++){a.addLink(n[i]);}}}.bind(this));};return h;},true);
