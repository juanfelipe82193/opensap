/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','sap/ui/Device','sap/ui/performance/trace/Passport','sap/ui/performance/trace/Interaction','sap/ui/performance/XHRInterceptor','sap/ui/performance/BeaconRequest','sap/base/util/Version'],function(U,D,P,I,X,B,V){"use strict";var f=false,b,o,i,R=P.getRootId(),H=window.location.host,C=D.os.name+"_"+D.os.version,a=D.browser.name+"_"+D.browser.version,c=h(),A="",s="",F,S=0,p="undetermined",d="undetermined_startup_0",e,g,w=new WeakMap();function h(){var E=0;if(D.system.combi){E=1;}else if(D.system.desktop){E=2;}else if(D.system.tablet){E=4;}else if(D.system.phone){E=3;}return E;}function j(T){var E=new Date(T);return E.toISOString().replace(/[^\d]/g,'');}function k(E){var G=new U(E).host();return G&&G!==H;}function l(){if(!k(arguments[1])){if(!F){F=P.getTransactionId();}var E=P.header(P.traceFlags(),R,P.getTransactionId(),p,d);this.setRequestHeader("SAP-PASSPORT",E);w.set(this,E);}}function m(){if(!k(arguments[1])){if(e&&g){this.setRequestHeader("SAP-Perf-FESRec",e);this.setRequestHeader("SAP-Perf-FESRec-opt",g);e=null;g=null;F=P.getTransactionId();}}}function n(E,G){return[r(R,32),r(F,32),r(E.navigation,16),r(E.roundtrip,16),r(G.timeToInteractive,16),r(E.completeRoundtrips,8),r(d,40,true),r(E.networkTime,16),r(E.requestTime,16),r(C,20),"SAP_UI5"].join(",");}function q(E,G){return[r(G.appNameShort,20,true),r(G.stepName,20,true),"",r(a,20),r(E.bytesSent,16),r(E.bytesReceived,16),"","",r(E.processing,16),E.requestCompression?"X":"","","","","",r(E.busyDuration,16),"",r(c,1),"",r(j(E.start),20),r(G.appNameLong,70,true)].join(",");}function r(E,L,G){if(!E){E=E===0?"0":"";}else if(typeof E==="number"){var J=E;E=Math.round(E).toString();if(E.length>L||J<0){E="-1";}}else{E=G?E.substr(-L,L):E.substr(0,L);}return E;}function t(E){var G=new V(E);return"@"+G.getMajor()+"."+G.getMinor()+"."+G.getPatch();}function u(E,G){e=n(E,G);g=q(E,G);}function v(E){S++;p=E?E.component+A:undefined;d=E?E.trigger+"_"+E.event+"_"+S:undefined;return d;}function x(E){var G=z.onBeforeCreated({stepName:E.trigger+"_"+E.event,appNameLong:E.stepComponent||E.component,appNameShort:E.stepComponent||E.component,timeToInteractive:E.duration},E);if(o||E.requests.length>0){u(E,G);if(o){F=null;}}if(o&&e&&g){o.append("SAP-Perf-FESRec",e+"SAP-Perf-FESRec-opt"+g);clearTimeout(i);i=setTimeout(y,60000);}if(s!=E.appVersion){s=E.appVersion;A=s?t(s):"";}d="undefined";}function y(){o.send();clearTimeout(i);i=setTimeout(y,60000);}var z={};z.getBeaconURL=function(){return b;};z.setActive=function(E,G){if(E&&!f){o=G?B.isSupported()&&new B({url:G}):null;b=G;f=true;P.setActive(true);I.setActive(true);X.register("PASSPORT_HEADER","open",l);if(!o){X.register("FESR","open",m);}I.onInteractionStarted=v;I.onInteractionFinished=x;I.passportHeader=w;}else if(!E&&f){f=false;I.setActive(false);X.unregister("FESR","open");if(X.isRegistered("PASSPORT_HEADER","open")){X.register("PASSPORT_HEADER","open",function(){this.setRequestHeader("SAP-PASSPORT",P.header(P.traceFlags(),R,P.getTransactionId()));});}if(o){o.send();clearTimeout(i);i=null;o=null;b=null;}I.onInteractionFinished=null;I.onInteractionStarted=null;}};z.getActive=function(){return f;};z.onBeforeCreated=function(E,G){return{stepName:E.stepName,appNameLong:E.appNameLong,appNameShort:E.appNameShort,timeToInteractive:E.timeToInteractive};};return z;});
