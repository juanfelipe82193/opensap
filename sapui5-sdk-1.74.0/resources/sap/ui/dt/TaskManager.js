/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/base/util/isPlainObject"],function(M,i){"use strict";var T=M.extend("sap.ui.dt.TaskManager",{metadata:{library:"sap.ui.dt",properties:{suppressEvents:{type:"boolean",defaultValue:false}},events:{add:{parameters:{taskId:"int"}},complete:{parameters:{taskId:"array"}}}},constructor:function(){M.apply(this,arguments);this._mList={};},_iNextId:0,_iTaskCounter:0});T.prototype._validateTask=function(t){if(!i(t)||!t.type||typeof t.type!=="string"){throw new Error("Invalid task specified");}};T.prototype._removeOutdatedTasks=function(t,d){if(d){var D;if(typeof d==="string"){D=function(t){return t[d];};}else if(typeof d==="function"){D=d;}else{throw new Error("Validator needs to be a function or a string");}var a=this._mList[t.type];var n=D(t);if(a&&n){this._mList[t.type]=a.filter(function(o){if(D(o)===n){this._iTaskCounter--;return false;}return true;}.bind(this));}}};T.prototype._addTask=function(t){var a=this._iNextId++;this._mList[t.type]=this._mList[t.type]||[];this._mList[t.type].push(Object.assign({},t,{id:a}));this._iTaskCounter++;if(!this.getSuppressEvents()){this.fireAdd({taskId:a});}return a;};T.prototype.add=function(t,d){this._validateTask(t);this._removeOutdatedTasks(t,d);return this._addTask(t);};T.prototype.complete=function(t){Object.keys(this._mList).forEach(function(s){this._mList[s]=this._mList[s].filter(function(m){if(m.id===t){this._iTaskCounter--;return false;}return true;}.bind(this));},this);if(!this.getSuppressEvents()){this.fireComplete({taskId:[t]});}};T.prototype.completeBy=function(t){this._validateTask(t);var c=[];this._mList[t.type]=this._mList[t.type].filter(function(l){var C=Object.keys(t).every(function(k){return l[k]&&l[k]===t[k];});if(C){this._iTaskCounter--;c.push(l.id);return false;}return true;}.bind(this));if(!this.getSuppressEvents()){this.fireComplete({taskId:c});}};T.prototype.cancel=function(t){this.complete(t);};T.prototype.isEmpty=function(){return this._iTaskCounter===0;};T.prototype.count=function(t){return this.getList(t).length;};T.prototype.getList=function(t){if(t){return this._mList[t]?this._mList[t].slice(0):[];}return Object.keys(this._mList).reduce(function(r,t){return r.concat(this._mList[t]);}.bind(this),[]);};T.prototype.destroy=function(){this.setSuppressEvents(true);this.getList().forEach(function(t){this.cancel(t.id);},this);M.prototype.destroy.apply(this,arguments);};return T;});
