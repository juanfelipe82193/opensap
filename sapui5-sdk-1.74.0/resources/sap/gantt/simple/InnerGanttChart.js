/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Core","sap/ui/core/Control","sap/ui/table/library","./GanttExtension","./InnerGanttChartRenderer"],function(q,C,a,t,G){"use strict";var I=a.extend("sap.gantt.simple.InnerGanttChart",{metadata:{events:{ganttReady:{parameters:{hasRenderedShapes:{type:"boolean"},totalRenderedShapes:{type:"int"}}}}}});I.prototype.getDomRef=function(s){var p=this.getParent(),d;if(s){d="-"+s;}else{d="-cnt";}if(p){return window.document.getElementById(p.getId()+d);}return null;};I.prototype.invalidate=function(){this.getUIArea().addInvalidatedControl(this);};I.prototype.hasRenderedShapes=function(){return this.$("svg").find(".sapGanttChartShapes").children().size()>0;};I.prototype.getTotalRenderedShapes=function(){return this.$("svg").find(".sapGanttChartShapes").children().size();};I.prototype.resolveWhenReady=function(w){return new Promise(function(r){var h=function handleEvent(e){if(w&&!e.getParameter("hasRenderedShapes")||(this.getParent().getTable().getVisibleRowCountMode()===t.VisibleRowCountMode.Auto&&this.getParent().getSyncedControl().getRowStates().length<this.getParent().getTable().getBinding("rows").getLength())){this.attachEventOnce("ganttReady",h);}else{r();}}.bind(this);if(Object.keys(this.getUIArea().mInvalidatedControls).indexOf(this.getParent().getId())>-1){this.attachEventOnce("ganttReady",h);}else if((!w&&this.getDomRef("svg"))||(w&&this.hasRenderedShapes())){r();}else{this.attachEventOnce("ganttReady",h);}}.bind(this));};I.prototype._updateRowsHoverState=function(){var g=this.getParent();setTimeout(function(){g.$("svg").find("rect.sapGanttBackgroundSVGRow:hover").each(function(){var e=g._getPointerExtension(),i=e._getRowIndexFromElement(this);g.getSyncedControl().syncRowHover(i,true);});g.$("svg").find("rect.sapGanttBackgroundSVGRow:not(:hover)").each(function(){var e=g._getPointerExtension(),i=e._getRowIndexFromElement(this);g.getSyncedControl().syncRowHover(i,false);});},0);};I.prototype.onBeforeRendering=function(e){if(!this.getParent()._bPreventInitialRender){this.getParent().jumpToVisibleHorizon("initialRender");}};I.prototype.onAfterRendering=function(e){var g=this.getParent();var o=g.getParent();if(o&&o.isA("sap.gantt.simple.GanttChartContainer")&&o.getGanttCharts().length>1){g.fireEvent("_initialRenderGanttChartsSync",{reasonCode:"initialRender",visibleHorizon:g.getAxisTimeStrategy().getVisibleHorizon(),visibleWidth:g.getVisibleWidth()});}var r=C.createRenderManager();this.getRenderer().renderRelationships(r,g);r.destroy();g._updateShapeSelections(g.getSelectedShapeUid(),[]);g._getConnectExtension().updateShapeConnectEffect(g);this._updateRowsHoverState();G.attachEvents(g);this.fireGanttReady({hasRenderedShapes:this.hasRenderedShapes(),totalRenderedShapes:this.getTotalRenderedShapes()});};return I;},true);
