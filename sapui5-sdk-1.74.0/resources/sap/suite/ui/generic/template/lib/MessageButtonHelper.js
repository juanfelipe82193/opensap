sap.ui.define(["sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper",'sap/ui/core/Element',"sap/base/util/extend"],function(B,M,a,F,b,c,t,E,e){"use strict";F=t.observableConstructor(F,true);var p=new F({path:"persistent",operator:b.EQ,value1:false});var s=new F({path:"technical",operator:b.EQ,value1:false});var v=new F({path:"validation",operator:b.EQ,value1:true});var I=new F({filters:[v,new F({path:"validation",operator:b.EQ,value1:false})],and:true});function g(T,h,d){var C=h.controller;var m=C.byId("showMessages");var A=false;var o;function f(i){return!!(i&&T.oCommonUtils.getPositionableControlId(i));}function j(i){if(h.getGroupTitle){return h.getGroupTitle(i);}return"";}var k;var l=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover",{beforeOpen:function(){var V=k.getCurrentContexts();if(h.prepareAllMessagesForNavigation){for(var i=0;i<V.length;i++){var W=V[i].getObject();if(!f(W.controlIds)){h.prepareAllMessagesForNavigation();return;}}}},isPositionable:f,getGroupTitle:j,titlePressed:function(i){c.navigateFromMessageTitleEvent(T.oCommonUtils,i,C);}});l.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");l.setGroupItems(true);k=l.getBinding("items");var n;(function(){var i=C.getOwnerComponent();n=new F({path:"target",operator:b.EQ,value1:"/"+i.getEntitySet()});var V=i.getModel("_templPriv");V.setProperty("/generic/messageCount",0);var W=T.oCommonUtils.getText("MESSAGE_BUTTON_TOOLTIP_P",0);V.setProperty("/generic/messageButtonTooltip",W);k.attachChange(function(){var X=k.getLength();V.setProperty("/generic/messageCount",X);W=T.oCommonUtils.getText(X===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",X);V.setProperty("/generic/messageButtonTooltip",W);});})();var L=new F({filters:[v,new F({path:"controlIds",test:function(i){return!!T.oCommonUtils.getPositionableControlId(i);},caseSensitive:true})],and:true});var q=[];var r;var u=0;var N;var w;var x;function y(V){if(Array.isArray(V)){var W=false;for(var i=0;i<V.length;i++){W=y(V[i])||W;}return W;}if(V instanceof Promise){V.then(N);return false;}x.push(V);return true;}function z(i){w=i;k.filter(w);}function D(){if(A){o=new F({filters:x,and:false});var i=[o,p];if(T.oServices.oApplication.needsToSuppressTechnicalStateMessages()){i.push(s);}var V=new F({filters:i,and:true});z(new F({filters:[V,L],and:false}));if(h.messageSorter){k.sort(h.messageSorter);}}}function R(i,V){if(i===u&&y(V)){D();}}function G(i){var V=i();return y(V);}function H(){q.forEach(G);}function J(i){r=i;u++;N=R.bind(null,u);x=d?[new F({path:"fullTarget",operator:b.StartsWith,value1:r}),n]:[];H();D();}function K(i){q.push(i);if(r!==undefined&&G(i)){D();}}var S;function O(){S=S||function(){if(k.getLength()>0){l.openBy(m);}};setTimeout(S,0);}function P(i){A=i;if(i){if(x){D();}}else{x=null;z(I);}}function Q(i){return i?L:w;}function U(){return o;}return{adaptToContext:J,toggleMessagePopover:l.toggle.bind(l,m),showMessagePopover:O,registerMessageFilterProvider:K,setEnabled:P,getMessageFilters:Q,getContextFilter:U};}return B.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(T,h,i){e(this,(t.testableStatic(g,"MessageButtonHelper"))(T,h,i));}});});
