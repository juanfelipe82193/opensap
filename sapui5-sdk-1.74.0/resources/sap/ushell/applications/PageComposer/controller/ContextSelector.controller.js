// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","./BaseDialog.controller","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(J,B,F,a){"use strict";var l,r;return B.extend("sap.ushell.applications.PageComposer.controller.ContextSelector",{constructor:function(v,R){this._oView=v;this.sViewId="contextSelector";this.sId="sap.ushell.applications.PageComposer.view.ContextSelector";r=R;},onSearch:function(e){var b=l.getBinding("items");var s=e.getSource().getValue()||"";b.filter([new F([new F("name",a.Contains,s),new F("title",a.Contains,s)],false)]);if(b.getLength()===0){if(s){l.setNoDataText(r.getText("Message.NoRolesFound"));}else{l.setNoDataText(r.getText("Message.NoRoles"));}}},onSelectionChange:function(){var s=l.getSelectedContexts(true);this._oModel.setProperty("/validRoleSelection",s&&!!s.length);},onConfirm:function(){this._writeSelectionToModel();this._oView.byId(this.sViewId).close();var s=this._oModel.getProperty("/selectedRoles");var A=this._oModel.getProperty("/availableRoles");var b=this._oModel.getProperty("/availableVisualizations");var R={selected:s,allSelected:s.length===A.length,availableVisualizations:b};if(this._fnConfirm){this._fnConfirm(R);}},onBeforeOpen:function(){l=this._oView.byId("contextSelectorList");this._setPreSelection();var f=this._oView.byId("contextSelector");sap.ui.getCore().getMessageManager().registerObject(f,true);},_writeSelectionToModel:function(){var s=[];var A=[];var S=l.getSelectedContexts(true);S.forEach(function(c){s.push(c.getObject().name);c.getObject().catalogs.results.forEach(function(b){b.visualizations.results.forEach(function(v){A.push(v.vizId);});});});this._oModel.setProperty("/selectedRoles",s);this._oModel.setProperty("/availableVisualizations",A);},_setPreSelection:function(){var s=this._oModel.getProperty("/selectedRoles");if(!s.length){l.selectAll();}else{l.getItems().forEach(function(i){s.forEach(function(b){if(i.getTitle()===b){i.setSelected(true);}});});}this._oModel.setProperty("/validRoleSelection",!!l.getSelectedItems().length);},initRoles:function(R,s){this._oModel=new J({availableRoles:R,selectedRoles:s||[],availableVisualizations:[],validRoleSelection:true,rolesAvailable:!!R.length});}});});
