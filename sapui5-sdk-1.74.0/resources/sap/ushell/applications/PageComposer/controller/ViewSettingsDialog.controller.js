// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/format/DateFormat","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter"],function(D,C,F,a,S){"use strict";return C.extend("sap.ushell.applications.PageComposer.controller.ViewSettingsDialog",{constructor:function(P){this.PageOverviewController=P;},handleDialogConfirm:function(e){var p=e.getParameters(),t=this.PageOverviewController.byId("table"),b=t.getBinding("items"),s=this.getSorters(p),f=this.getFilters(p);b.sort(s);this.PageOverviewController.aViewSettingsFilters=f;this.PageOverviewController._applyCombinedFilters();this.PageOverviewController.byId("infoFilterBar").setVisible(f.length>0);this.PageOverviewController.byId("infoFilterLabel").setText(p.filterString);},getSorters:function(p){var s=[],g=p.groupItem,r=this.PageOverviewController.getResourceBundle();if(g){var G=g.getKey(),f;switch(G){case"content/editAllowed":f=function(c){var n=c.getProperty(G);return{key:n,text:n?r.getText("Message.StatusAssigned"):r.getText("Message.NotAssigned")};};break;case"content/createdOn":case"content/modifiedOn":f=function(c){var o=D.getInstance({style:"medium"});var d=c.getProperty(G),b=o.format(d);return{key:b,text:b};};break;default:f=function(c){var n=c.getProperty(G);return{key:n,text:n};};}s.push(new S(G,p.groupDescending,f));}if(p.sortItem){s.push(new S(p.sortItem.getKey(),p.sortDescending));}else{s.push(new S("content/modifiedOn",true));}return s;},getFilters:function(p){var f=[];p.filterItems.forEach(function(i){var P,o,v,V;if(i.getKey()==="content/createdOn"||i.getKey()==="content/modifiedOn"){var d=i.getCustomControl();P=i.getKey();o=a.BT;v=d.getDateValue();V=d.getSecondDateValue();if(P==="content/createdOn"){this._createdOnFromFilter=v;this._createdOnToFilter=V;}else{this._changedOnFromFilter=v;this._changedOnToFilter=V;}}else{var s=i.getKey().split("___");P=s[0];o=s[1];v=s[2];V=s[3];if(P==="content/editAllowed"){if(v==="true"){v=true;}else{v=false;}}}f.push(new F(P,o,v,V));}.bind(this));return f;},handleDateRangeSelectionChanged:function(e){var p=e.getParameters(),v=p.id==="CreatedOnDateRangeSelection"?sap.ui.getCore().byId("CreatedOnFilter"):sap.ui.getCore().byId("ChangedOnFilter");if(p.from){v.setFilterCount(1);v.setSelected(true);}else{v.setFilterCount(0);v.setSelected(false);}},handleCancel:function(){var c=sap.ui.getCore().byId("CreatedOnFilter"),o=sap.ui.getCore().byId("CreatedOnDateRangeSelection"),b=sap.ui.getCore().byId("ChangedOnFilter"),d=sap.ui.getCore().byId("ChangedOnDateRangeSelection");if(this._createdOnFromFilter){c.setFilterCount(1);c.setSelected(true);}else{c.setFilterCount(0);c.setSelected(false);}if(this._changedOnFromFilter){b.setFilterCount(1);b.setSelected(true);}else{b.setFilterCount(0);b.setSelected(false);}o.setDateValue(this._createdOnFromFilter);o.setSecondDateValue(this._createdOnToFilter);d.setDateValue(this._changedOnFromFilter);d.setSecondDateValue(this._changedOnToFilter);},handleResetFilters:function(){var c=sap.ui.getCore().byId("CreatedOnDateRangeSelection"),o=sap.ui.getCore().byId("ChangedOnDateRangeSelection"),b=sap.ui.getCore().byId("CreatedOnFilter"),d=sap.ui.getCore().byId("ChangedOnFilter");c.setDateValue();c.setSecondDateValue();o.setDateValue();o.setSecondDateValue();b.setFilterCount(0);b.setSelected(false);d.setFilterCount(0);d.setSelected(false);}});});
