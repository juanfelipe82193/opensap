// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageToast","./BaseDialog.controller"],function(F,J,M,B){"use strict";return B.extend("sap.ushell.applications.PageComposer.controller.ConfirmChangesDialog.controller",{constructor:function(v,r){this._oView=v;this._oResourceBundle=r;this.sViewId="confirmChangesDialog";this.sId="sap.ushell.applications.PageComposer.view.ConfirmChangesDialog";},onAfterClose:function(e){e.getSource().destroy();},onCancel:function(e){e.getSource().getParent().close();},onDismissChanges:function(e){var c=this._oView.getController();e.getSource().getParent().close();c._setDirtyFlag(false);c.getRouter().navTo("overview",null,null,true);},onOverwriteChanges:function(e){return new Promise(function(r,a){var c=this._oView.getController();var R=c.getPageRepository();var p=this._oView.getModel().getProperty("/page");var s=this._oView.getModel().getProperty("/simpleError");var S=s.statusCode;var t=this;e.getSource().getParent().close();if(S==="412"){R.getPage(p.content.id).then(function(n){p.content.modifiedOn=n.content.modifiedOn;R.updatePage(p).then(function(){t._successfulSave(t._oResourceBundle);r();}).catch(function(){c.showMessageBoxError(t._oResourceBundle.getText("Message.UpdatePageError"),false);r();});}).catch(function(){c.showMessageBoxError(t._oResourceBundle.getText("Message.LoadPageError"),false);r();});}else if(S==="400"){R.createPage(p).then(function(){t._successfulSave(t._oResourceBundle);r();}).catch(function(){c.showMessageBoxError(t._oResourceBundle.getText("Message.CreatePageError"),false);r();});}else{a();}}.bind(this));},_successfulSave:function(r){var c=this._oView.getController();M.show(r.getText("Message.SavedChanges"),{closeOnBrowserNavigation:false});c._setDirtyFlag(false);}});});
