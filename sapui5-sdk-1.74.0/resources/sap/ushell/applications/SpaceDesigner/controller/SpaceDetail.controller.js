// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/base/Log","sap/base/strings/formatMessage"],function(B,J,M,L,f){"use strict";return B.extend("sap.ushell.applications.SpaceDesigner.controller.SpaceDetail",{onInit:function(){var r=this.getRouter();r.getRoute("view").attachPatternMatched(this._onPageMatched,this);this.setModel(new J({space:{},editMode:false,transportSupported:this.getOwnerComponent().isTransportSupported()}));this.getView().addEventDelegate({onBeforeHide:this.onRouteLeave.bind(this)});},onExit:function(){this.space.exit();},formatMessage:f,_onPageMatched:function(e){var a=e.getParameter("arguments");var s=a.spaceId;var r=this.getOwnerComponent().getRole();this.getModel().setProperty("/space",{});this.getView().setBusy(true);L.info("The space with id "+s+" was opened in view mode scoped by the following role",r);this._loadSpace(decodeURIComponent(s)).then(function(S){this.getModel().setProperty("/space",S);}.bind(this)).catch(function(){this.navigateToErrorPage(s);}.bind(this)).finally(function(){this.getView().setBusy(false);}.bind(this));},_loadSpace:function(s){return Promise.all([this.getSpaceRepository().getSpace(s)]).then(function(p){this.getModel().updateBindings(true);return p[1];}.bind(this));},_navigateToEdit:function(s){},_deleteSpace:function(e){var d=e.getSource().getParent();var t=e.metadata&&e.metadata.transportId||"";var s=this.getModel().getProperty("/space/content/id");var S=this.getResourceBundle().getText("Message.SuccessDeletePage");return this.getSpaceRepository().deleteSpace(s,t).then(function(){this.navigateToPageOverview();M.show(S,{closeOnBrowserNavigation:false});d.close();}.bind(this)).catch(this.handleBackendError.bind(this));},onEdit:function(){this._navigateToEdit(this.getModel().getProperty("/page/content/id"));},onDelete:function(){var s=this.getModel().getProperty("/space");this.checkShowDeleteDialog(s,this._deleteSpace.bind(this));},onCopy:function(){var p=this.getModel().getProperty("/page");this.showCopyDialog(p,function(a){sap.ushell.Container.getServiceAsync("PageReferencing").then(function(P){return P.createReferencePage(a,[]);}).then(function(r){return this.getPageRepository().copyPage(r);}.bind(this)).then(function(){this._navigateToEdit(a.content.targetId);M.show(this.getResourceBundle().getText("Message.PageCreated"),{closeOnBrowserNavigation:false});}.bind(this)).catch(this.handleBackendError.bind(this));}.bind(this));}});});
