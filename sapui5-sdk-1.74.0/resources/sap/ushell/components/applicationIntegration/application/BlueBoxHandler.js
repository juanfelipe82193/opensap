// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/application/Application","sap/ui/thirdparty/URI","sap/ui/thirdparty/jquery"],function(A,U,q){"use strict";function B(){var c,t=this,a,C={"isStateful":{handler:function(d,o){if(d&&(d.enabled===true||d===true)){return true;}return false;}},"isGUI":{handler:function(d,o){if(d&&d.protocol==="GUI"){return true;}return false;}},"isGUIStateful":{handler:function(d,o){return t.isCapUT(o,"isGUI")&&t.isCapUT(o,"isStateful");}},"isFLP":{handler:function(d,o){return!t.isCapUT(o,"isGUI")&&t.isCapUT(o,"isStateful");}}},b={},s={},h={"DEFAULT":{storageIdentifier:function(u){return this._stripURL(u);},setup:function(T,S){},isContentLoaded:function(i){return false;},create:function(i,u,S){return A.postMessageToIframeApp(i,"sap.ushell.services.appLifeCycle","create",{sCacheId:S,sUrl:u,sHash:window.hasher.getHash()});},destroy:function(i){return A.postMessageToIframeApp(i,"sap.ushell.services.appLifeCycle","destroy",{});},store:function(i,S){},restore:function(i,S){}},"URL":{setup:function(T,S){},create:function(i,u,S){var o=new U();if(o.query(true).hasOwnProperty("sap-isolation-enabled")){var p=sap.ushell.Container.getService("URLParsing"),H=p.getHash(o.toString());if(H){var d=p.parseShellHash("#"+H),P=p.paramsToString(d.params);if(P&&P.length>=0){var e=sap.ushell.Container.getService("AppState").createEmptyAppState(),f=sap.ushell.Container.getService("AppState").createEmptyAppState(),g="";if(P.indexOf("sap-intent-param")>=0){g=encodeURIComponent(P);}else{e.setData(P);e.save();g=encodeURIComponent("sap-intent-param="+e.getKey());}f.setData("sap-startup-params="+g);f.save();u=u.split("#")[0]+"&sap-intent-param="+f.getKey()+"#"+window.hasher.getHash();}else{u=u.split("#")[0]+"#"+window.hasher.getHash();}}else{u+="#"+window.hasher.getHash();}}return A.postMessageToIframeApp(i,"sap.ushell.services.appLifeCycle","create",{sCacheId:S,sUrl:u,sHash:window.hasher.getHash()},true);},destroy:function(i,S){return A.postMessageToIframeApp(i,"sap.ushell.services.appLifeCycle","destroy",{sCacheId:S},true);},store:function(i,S){return A.postMessageToIframeApp(i,"sap.ushell.services.appLifeCycle","store",{sCacheId:S},true);},restore:function(i,S){return A.postMessageToIframeApp(i,"sap.ushell.services.appLifeCycle","restore",{sCacheId:S,sHash:window.hasher.getHash()},true);}}};this.init=function(S,i,d){c={};A.init(this);a=d;if(i){s=q.extend(true,s,i.supportedTypes);}};this.isStatefulContainerSupported=function(o){var i=this.isCapabilitySupported(o,"sap.ushell.services.appLifeCycle","create")&&this.isCapabilitySupported(o,"sap.ushell.services.appLifeCycle","destroy");return i;};this.isKeepAliveSupported=function(o){var i=this.isCapabilitySupported(o,"sap.ushell.services.appLifeCycle","store")&&this.isCapabilitySupported(o,"sap.ushell.services.appLifeCycle","restore");return i;};this.mapCapabilities=function(o,d){this.setCapabilities(o,d);};this.getCapabilities=function(o){return b[o].oCapMap;};this.isCapabilitySupported=function(o,S,i){if(b[o]&&b[o].oCapMap&&b[o].oCapMap[S]){return!!b[o].oCapMap[S][i];}return false;};this.setCapabilities=function(o,d){var e;if(!b[o]){b[o]={BlueBox:o};}if(!b[o].oCapMap){b[o].oCapMap={};}e=b[o].oCapMap;Object.keys(d).forEach(function(k){var f=d[k],g;if(!e[f.service]){e[f.service]={};}g=e[f.service];g[f.action]=true;});if(!o.getIsStateful()&&this.isStatefulContainerSupported(o)){o.setIsStateful(true);}};this.hasIFrame=function(o){if(o&&o._getIFrame){return true;}return false;};this.getStorageKey=function(o){return b[o].sStorageKey;};this.setAppCapabilities=function(o,d){if(!b[o]){b[o]={BlueBox:o};}b[o].appCapabilities=d;};this.forEach=function(d){var k;for(k in b){if(b.hasOwnProperty(k)){d(b[k].BlueBox);}}};this.isCapByTarget=function(T,d){if(T.appCapabilities===undefined){return false;}if(C[d]&&T&&T.appCapabilities){return C[d].handler(T.appCapabilities);}return T.appCapabilities[d]||false;};this.isCapUT=function(o,d){var e=b[o];if(e===undefined||e.appCapabilities===undefined){return false;}if(C[d]&&e){return C[d].handler(e.appCapabilities,o);}return e.appCapabilities[d]||false;};this.setStorageKey=function(o,d){if(!b[o]){b[o]={BlueBox:o};}b[o].sStorageKey=d;};this.getStorageKey=function(o){if(!b[o]){return undefined;}return b[o].sStorageKey;};this.getHandler=function(){return q.extend(true,h.DEFAULT,h["URL"]);};this._stripURL=function(u){var n=u.indexOf("?"),d=u.indexOf("#"),e;if(n>=0){e=u.substr(0,n);}else if(d>=0){e=u.substr(0,d);}else{e=u;}return e;};this.deleteStateFul=function(u){var d=this._stripURL(u);return this.delete(d);};this.getStateFul=function(u){var d=this._stripURL(u);return this.get(d);};this.destroyApp=function(d){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","destroy",{appId:d});};this.openApp=function(d){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","create",{appId:d,sHash:window.hasher.getHash()});};this.storeApp=function(d){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","store",{appId:d,sHash:window.hasher.getHash()});};this.restoreApp=function(d){a.postMessageToIframeApp("sap.ushell.services.appLifeCycle","restore",{appId:d,sHash:window.hasher.getHash()});};this.delete=function(u){if(c[u]){delete c[u];}};this.get=function(u){return c[u];};this.getById=function(i){for(var k in c){if(c.hasOwnProperty(k)){var e=c[k];if(e.sId===i){return e;}}}};this.set=function(u,i){var S=this._stripURL(u);c[S]=i;};}return new B();},true);
