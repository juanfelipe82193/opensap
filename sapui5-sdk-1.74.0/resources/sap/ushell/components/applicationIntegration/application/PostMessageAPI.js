// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ui/core/Popup","sap/ui/core/library","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/core/UIComponent","sap/ushell/services/AppConfiguration","sap/ushell/ui/footerbar/SendAsEmailButton","sap/ushell/ui/footerbar/AddBookmarkButton"],function(u,P,c,q,L,U,A,S,a){"use strict";var d=new U(),p;var o={"sap.ushell.services.CrossApplicationNavigation":{oServiceCalls:{"hrefForExternal":{executeServiceCallFn:function(e){return new q.Deferred().resolve(sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal(e.oMessageData.body.oArgs)).promise();}},"getSemanticObjectLinks":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(e.oMessageData.body.sSemanticObject,e.oMessageData.body.mParameters,e.oMessageData.body.bIgnoreFormFactors,undefined,undefined,e.oMessageData.body.bCompactIntents);}},"isIntentSupported":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(e.oMessageData.body.aIntents);}},"isNavigationSupported":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported(e.oMessageData.body.aIntents);}},"backToPreviousApp":{executeServiceCallFn:function(){sap.ushell.Container.getService("CrossApplicationNavigation").backToPreviousApp();return new q.Deferred().resolve().promise();}},"historyBack":{executeServiceCallFn:function(e){sap.ushell.Container.getService("CrossApplicationNavigation").historyBack(e.oMessageData.body.iSteps);return new q.Deferred().resolve().promise();}},"getAppStateData":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").getAppStateData(e.oMessageData.body.sAppStateKey);}},"toExternal":{executeServiceCallFn:function(e){var g=u.clone(e.oMessageData.body.oArgs);u.storeSapSystemToLocalStorage(g);return new q.Deferred().resolve(sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(g)).promise();}},"registerBeforeAppCloseEvent":{executeServiceCallFn:function(e){e.oContainer.setBeforeAppCloseEvent({enabled:true,params:e.oMessageData.body});return new q.Deferred().resolve().promise();}}}},"sap.ushell.ui5service.ShellUIService":{oServiceCalls:{"setTitle":{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setTitle(e.oMessageData.body.sTitle)).promise();}},"setBackNavigation":{executeServiceCallFn:function(e){return e.executeSetBackNavigationService(e.oMessage,e.oMessageData);}}}},"sap.ushell.services.ShellUIService":{oServiceCalls:{"setTitle":{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setTitle(e.oMessageData.body.sTitle)).promise();}},"setHierarchy":{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setHierarchy(e.oMessageData.body.aHierarchyLevels)).promise();}},"setRelatedApps":{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setRelatedApps(e.oMessageData.body.aRelatedApps)).promise();}},"setDirtyFlag":{executeServiceCallFn:function(e){sap.ushell.Container.setDirtyFlag(e.oMessageData.body.bIsDirty);return new q.Deferred().resolve().promise();}},"showShellUIBlocker":{executeServiceCallFn:function(e){s(e.oMessageData.body.bShow);return new q.Deferred().resolve().promise();}},"getFLPUrl":{executeServiceCallFn:function(e){var i=false;if(e.oMessageData.body&&e.oMessageData.body.bIncludeHash===true){i=true;}return new q.Deferred().resolve(sap.ushell.Container.getFLPUrl(i)).promise();}},"getShellGroupIDs":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").getShellGroupIDs((e.oMessageData.body?e.oMessageData.body.bGetAll:undefined));}},"addBookmark":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").addBookmarkByGroupId(e.oMessageData.body.oParameters,e.oMessageData.body.groupId);}},"addBookmarkDialog":{executeServiceCallFn:function(e){var g=new a();g.firePress({});return new q.Deferred().resolve().promise();}},"getShellGroupTiles":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("LaunchPage").getTilesByGroupId(e.oMessageData.body.groupId);}},"sendUrlAsEmail":{executeServiceCallFn:function(e){var g=new S();g.firePress({});return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.Container":{oServiceCalls:{"setDirtyFlag":{executeServiceCallFn:function(e){sap.ushell.Container.setDirtyFlag(e.oMessageData.body.bIsDirty);return new q.Deferred().resolve().promise();}},"getFLPUrl":{executeServiceCallFn:function(e){var i=false;if(e.oMessageData.body&&e.oMessageData.body.bIncludeHash===true){i=true;}return new q.Deferred().resolve(sap.ushell.Container.getFLPUrl(i)).promise();}},"getFLPConfig":{executeServiceCallFn:function(e){var D=new q.Deferred();sap.ushell.Container.getFLPConfig().then(function(F){D.resolve(F);});return D.promise();}}}},"sap.ushell.services.AppState":{oServiceCalls:{"getAppState":{executeServiceCallFn:function(e){var D=new q.Deferred();sap.ushell.Container.getService("AppState").getAppState(e.oMessageData.body.sKey).done(function(g){delete g._oServiceInstance;D.resolve(g);}).fail(function(g){delete g._oServiceInstance;D.resolve(g);});return D.promise();}},"_saveAppState":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("AppState")._saveAppState(e.oMessageData.body.sKey,e.oMessageData.body.sData,e.oMessageData.body.sAppName,e.oMessageData.body.sComponent,e.oMessageData.body.bTransient,e.oMessageData.body.iPersistencyMethod,e.oMessageData.body.oPersistencySettings);}},"_loadAppState":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("AppState")._loadAppState(e.oMessageData.body.sKey);}},"makeStatePersistent":function(e){return sap.ushell.Container.getService("AppState").makeStatePersistent(e.oMessageData.body.sKey,e.oMessageData.body.iPersistencyMethod,e.oMessageData.body.oPersistencySettings);}}},"sap.ushell.services.Bookmark":{oServiceCalls:{"addBookmarkUI5":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").addBookmark(e.oMessageData.body.oParameters,e.oMessageData.body.oGroup);}},"addBookmark":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").addBookmarkByGroupId(e.oMessageData.body.oParameters,e.oMessageData.body.groupId);}},"getShellGroupIDs":{executeServiceCallFn:function(){return sap.ushell.Container.getService("Bookmark").getShellGroupIDs();}},"addCatalogTileToGroup":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").addCatalogTileToGroup(e.oMessageData.body.sCatalogTileId,e.oMessageData.body.sGroupId,e.oMessageData.body.oCatalogData);}},"countBookmarks":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").countBookmarks(e.oMessageData.body.sUrl);}},"deleteBookmarks":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").deleteBookmarks(e.oMessageData.body.sUrl);}},"updateBookmarks":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("Bookmark").updateBookmarks(e.oMessageData.body.sUrl,e.oMessageData.body.oParameters);}}}},"sap.ushell.services.AppConfiguration":{oServiceCalls:{"setApplicationFullWidth":{executeServiceCallFn:function(e){A.setApplicationFullWidth(e.oMessageData.body.bValue);return new q.Deferred().resolve().promise();}}}}};function b(){}b.prototype.getAPIs=function(){this._registerAppRuntimeNewAPI();return o;};b.prototype.addShellCommunicationHandler=function(k,C){var e=o[k],n;if(e){if(C.oServiceCalls){Object.keys(C.oServiceCalls).forEach(function(g){e.oServiceCalls[g]=C.oServiceCalls[g];});}if(C.oRequestCalls){Object.keys(C.oRequestCalls).forEach(function(g){e.oRequestCalls[g]=C.oRequestCalls[g];});}return;}n={oRequestCalls:{},oServiceCalls:{}};if(C.oServiceCalls){Object.keys(C.oServiceCalls).forEach(function(g){n.oServiceCalls[g]=C.oServiceCalls[g];});}if(C.oRequestCalls){Object.keys(C.oRequestCalls).forEach(function(g){n.oRequestCalls[g]=C.oRequestCalls[g];});}o[k]=n;};b.prototype._getPostMesageInterface=function(e,i){var C,g=this.getAPIs();if(g[e]){C=g[e];if(C&&C.oRequestCalls&&C.oRequestCalls[i]){return C.oRequestCalls[i];}}return undefined;};b.prototype.registerShellCommunicationHandler=function(C){var t=this,e;Object.keys(C).forEach(function(k){e=C[k];t.addShellCommunicationHandler(k,e);});};b.prototype.isActiveOnly=function(e,i){var C=this._getPostMesageInterface(e,i);if(C){return C.isActiveOnly;}return undefined;};b.prototype.getResponseHandler=function(e,i){var C=this._getPostMesageInterface(e,i);if(C){return C.fnResponseHandler;}return undefined;};b.prototype._createNewInnerAppState=function(g){var h=sap.ushell.Container.getService("AppState"),n,H,C,N,v;n=h.createEmptyAppState(undefined,false);if(g.oMessageData.body.sData!==undefined){try{v=JSON.parse(g.oMessageData.body.sData);}catch(e){v=g.oMessageData.body.sData;}}else{v="";}n.setData(v);n.save();N=n.getKey();H=window.hasher.getHash();if(H.indexOf("&/")>0){if(H.indexOf("sap-iapp-state=")>0){C=/(?:sap-iapp-state=)([^&/]+)/.exec(H)[1];H=H.replace(C,N);}else{H=H+"/sap-iapp-state="+N;}}else{H=H+"&/sap-iapp-state="+N;}window.hasher.changed.active=false;window.hasher.replaceHash(H);window.hasher.changed.active=true;return N;};b.prototype._setInnerAppStateData=function(e){return b.prototype._createNewInnerAppState(e);};b.prototype._registerAppRuntimeNewAPI=function(){if(this.newAPIAdded!==undefined){return;}this.newAPIAdded=true;this.registerShellCommunicationHandler({"sap.ushell.appRuntime":{oRequestCalls:{"innerAppRouteChange":{isActiveOnly:true,distributionType:["all"]},"hashChange":{isActiveOnly:true,distributionType:["URL"]},"setDirtyFlag":{isActiveOnly:true,distributionType:["URL"]},"themeChange":{isActiveOnly:false,distributionType:["all"]},"uiDensityChange":{isActiveOnly:false,distributionType:["all"]}},oServiceCalls:{"hashChange":{executeServiceCallFn:function(e){window.hasher.replaceHash(e.oMessageData.body.newHash);return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.UserInfo":{oServiceCalls:{"getThemeList":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("UserInfo").getThemeList();}}}},"sap.ushell.services.ShellNavigation":{oServiceCalls:{"toExternal":{executeServiceCallFn:function(e){sap.ushell.Container.getService("ShellNavigation").toExternal(e.oMessageData.body.oArgs,undefined,e.oMessageData.body.bWriteHistory);return new q.Deferred().resolve().promise();}},"toAppHash":{executeServiceCallFn:function(e){sap.ushell.Container.getService("ShellNavigation").toAppHash(e.oMessageData.body.sAppHash,e.oMessageData.body.bWriteHistory);return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.NavTargetResolution":{oServiceCalls:{"getDistinctSemanticObjects":{executeServiceCallFn:function(){return sap.ushell.Container.getService("NavTargetResolution").getDistinctSemanticObjects();}},"expandCompactHash":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("NavTargetResolution").expandCompactHash(e.oMessageData.body.sHashFragment);}},"resolveHashFragment":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("NavTargetResolution").expandCompactHash(e.oMessageData.body.sHashFragment);}},"isNavigationSupported":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("NavTargetResolution").isNavigationSupported(e.oMessageData.body.aIntents);}}}},"sap.ushell.services.CrossApplicationNavigation":{oServiceCalls:{"expandCompactHash":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").expandCompactHash(e.oMessageData.body.sHashFragment);}},"getDistinctSemanticObjects":{executeServiceCallFn:function(){return sap.ushell.Container.getService("CrossApplicationNavigation").getDistinctSemanticObjects();}},"getLinks":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").getLinks(e.oMessageData.body);}},"getPrimaryIntent":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").getPrimaryIntent(e.oMessageData.body.sSemanticObject,e.oMessageData.body.mParameters);}},"hrefForAppSpecificHash":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").hrefForAppSpecificHash(e.oMessageData.body.sAppHash);}},"isInitialNavigation":{executeServiceCallFn:function(){return sap.ushell.Container.getService("CrossApplicationNavigation").hrefForAppSpecificHash();}},"getAppState":{executeServiceCallFn:function(e){var D=new q.Deferred();sap.ushell.Container.getService("CrossApplicationNavigation").getAppState(d,e.oMessageData.body.sAppStateKey).done(function(g){delete g._oServiceInstance;D.resolve(g);});return D.promise();}},"setInnerAppRoute":{executeServiceCallFn:function(e){var g=sap.ushell.Container.getService("URLParsing"),h=g.parseShellHash(window.hasher.getHash()),n;h.appSpecificRoute=e.oMessageData.body.appSpecificRoute;n="#"+g.constructShellHash(h);window.hasher.changed.active=false;window.hasher.replaceHash(n);window.hasher.changed.active=true;return new q.Deferred().resolve().promise();}},"setInnerAppStateData":{executeServiceCallFn:function(e){var k=b.prototype._setInnerAppStateData(e);return new q.Deferred().resolve(k).promise();}}}},"sap.ushell.services.Renderer":{oServiceCalls:{"addHeaderItem":{executeServiceCallFn:function(e){f("addHeaderItem",e);return new q.Deferred().resolve().promise();}},"addHeaderEndItem":{executeServiceCallFn:function(e){f("addHeaderEndItem",e);return new q.Deferred().resolve().promise();}},"showHeaderItem":{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").showHeaderItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},"showHeaderEndItem":{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").showHeaderEndItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},"hideHeaderItem":{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").hideHeaderItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},"hideHeaderEndItem":{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").hideHeaderEndItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},"setHeaderTitle":{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").setHeaderTitle(e.oMessageData.body.sTitle);return new q.Deferred().resolve().promise();}},"setHeaderVisibility":{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").setHeaderVisibility(e.oMessageData.body.bVisible,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.LaunchPage":{oServiceCalls:{"getGroupsForBookmarks":{executeServiceCallFn:function(){return sap.ushell.Container.getService("LaunchPage").getGroupsForBookmarks();}}}}});};function s(e){if(e===true&&p===undefined){p=new P();p.setShadow(true);p.setModal(true,"sapMDialogBlockLayerInit");p.setNavigationMode("SCOPE");p.eOpenState=c.OpenState.OPEN;q("#shell-cntnt").css("zIndex",40);p._iZIndex=30;p._duringOpen();}else if(e===false&&p!==undefined){p._oLastPosition=p._oDefaultPosition;p.destroy();p=undefined;q("#shell-cntnt").css("zIndex","auto");}}function f(e,g){sap.ushell.Container.getRenderer("fiori2")[e]("sap.ushell.ui.shell.ShellHeadItem",{id:g.oMessageData.body.sId,tooltip:g.oMessageData.body.sTooltip,icon:g.oMessageData.body.sIcon,press:function(){g.oContainer.postMessageRequest("sap.ushell.appRuntime.buttonClick",{buttonId:g.oMessageData.body.sId});}},g.oMessageData.body.bVisible,g.oMessageData.body.bCurrentState||true,g.oMessageData.body.aStates);}return new b();},false);
