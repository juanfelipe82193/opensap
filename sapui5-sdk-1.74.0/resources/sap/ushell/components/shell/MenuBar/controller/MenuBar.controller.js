// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/base/util/ObjectPath","sap/ushell/EventHub"],function(C,J,O,E){"use strict";return C.extend("sap.ushell.components.shell.MenuBar.controller.MenuBar",{onInit:function(){this.oContainerRouter=sap.ushell.Container.getRenderer().getRouter();this.oContainerRouter.getRoute("home").attachMatched(this._selectIndexAfterRouteChange,this);this.oContainerRouter.getRoute("openFLPPage").attachMatched(this._selectIndexAfterRouteChange,this);this.oEventHubListener=E.on("enableMenuBarNavigation").do(function(e){this.getView().getModel("viewConfiguration").setProperty("/enableMenuBarNavigation",e);}.bind(this));var v=new J({selectedKey:"None Existing Key",enableMenuBarNavigation:true});this.getView().setModel(v,"viewConfiguration");this.oURLParsingService=sap.ushell.Container.getServiceAsync("URLParsing");this._selectIndexAfterRouteChange();},onMenuItemSelection:function(e){var s=e.getParameter("key");var m=this.getView().getModel("menu");var d=m.getProperty("/").find(function(M){return M.uid===s;});if(d.type==="intent"){this._performCrossApplicationNavigation(d.target);}if(d.type==="url"){this._openURL(d.target);}},_performCrossApplicationNavigation:function(d){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(c){var p={};d.parameters.forEach(function(P){if(P.name&&P.value){p[P.name]=[P.value];}});c.toExternal({target:{semanticObject:d.semanticObject,action:d.action},params:p});});},_openURL:function(d){window.open(d.url,"_blank");},_selectIndexAfterRouteChange:function(){var v=this.getView().getModel("viewConfiguration");return this.oURLParsingService.then(function(u){var h=u.parseShellHash(window.hasher.getHash());if(h.action==="home"){v.setProperty("/selectedKey","");}else{var s=this._getMenuUID(O.get("params.spaceId.0",h),O.get("params.pageId.0",h));if(s){v.setProperty("/selectedKey",s);}else{v.setProperty("/selectedKey","None Existing Key");}}}.bind(this));},_getMenuUID:function(s,p){var m=this.getView().getModel("menu").getProperty("/");var M=m.find(function(o){var S=o.target.parameters.find(function(a){return a.name==="spaceId"&&a.value===s;});var P=o.target.parameters.find(function(a){return a.name==="pageId"&&a.value===p;});return S&&P;});return M&&M.uid;},onExit:function(){this.oEventHubListener.off();}});});
