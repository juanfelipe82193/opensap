// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath"],function(L,O){"use strict";var P=function(){this._oCDMPagesRequests={};this._sComponent="sap/ushell/adapters/cdm/PagesCommonDataModelAdapter";};P.prototype.getSite=function(){var d=new jQuery.Deferred();sap.ushell.Container.getServiceAsync("Menu").then(function(m){return m.getMenuEntries();}).then(function(m){if(!O.get("target.parameters",m[0])){var e="PagesCommonDataModelAdapter: Couldn't determine the default page from the first menu entry";L.error(e,null,this._sComponent);return Promise.reject(e);}var p=m[0].target.parameters.find(function(o){return o.name==="pageId";});return this._getPage(p&&p.value);}.bind(this)).then(d.resolve).catch(d.reject);return d.promise();};P.prototype._getPage=function(p){if(!p){var e="PagesCommonDataModelAdapter: _getPage was called without a pageId";L.fatal(e,null,this._sComponent);return Promise.reject(e);}if(this._oCDMPagesRequests[p]){return this._oCDMPagesRequests[p];}this._oCDMPagesRequests[p]=Promise.all([sap.ushell.Container.getServiceAsync("NavigationDataProvider"),sap.ushell.Container.getServiceAsync("VisualizationDataProvider"),sap.ushell.Container.getServiceAsync("PagePersistence")]).then(function(s){return Promise.all([s[2].getPage(p),s[1].getVisualizationData(),s[0].getNavigationData(),sap.ushell.Container.getServiceAsync("PageReferencing")]);}).then(function(r){var o=r[0].content;var v=r[1];var n=r[2];var a=r[3];var c=a.dereferencePage(o,v,n);return c;}).catch(function(E){L.fatal("PagesCommonDataModelAdapter encountered an error while fetching required services: ",E,this._sComponent);return Promise.reject(E);}.bind(this));return this._oCDMPagesRequests[p];};P.prototype.getPersonalization=function(){return new jQuery.Deferred().resolve({}).promise();};P.prototype.setPersonalization=function(p){return new jQuery.Deferred().resolve().promise();};return P;},true);
