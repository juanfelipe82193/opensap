//Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/f/GridContainerItemLayoutData","sap/m/library","sap/ui/core/XMLComposite","sap/ushell/resources","sap/ushell/utils","sap/ui/core/ResizeHandler"],function(G,l,X,r,u,R){"use strict";var T=l.TileSizeBehavior;var S=X.extend("sap.ushell.ui.launchpad.Section",{metadata:{library:"sap.ushell",properties:{editable:{type:"boolean",group:"Misc",defaultValue:false},enableAddButton:{type:"boolean",group:"Behavior",defaultValue:true},enableDeleteButton:{type:"boolean",group:"Behavior",defaultValue:true},enableGridBreakpoints:{type:"boolean",group:"Appearance",defaultValue:false},enableResetButton:{type:"boolean",group:"Behavior",defaultValue:true},enableShowHideButton:{type:"boolean",group:"Behavior",defaultValue:true},enableVisualizationReordering:{type:"boolean",group:"Behavior",defaultValue:false},noVisualizationsText:{type:"string",group:"Appearance",defaultValue:r.i18n.getText("Section.NoVisualizationsText")},title:{type:"string",group:"Appearance",defaultValue:""},showNoVisualizationsText:{type:"boolean",group:"Behavior",defaultValue:false},showSection:{type:"boolean",group:"Misc",defaultValue:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",group:"Misc",defaultValue:T.Responsive}},defaultAggregation:"visualizations",aggregations:{visualizations:{type:"sap.ui.core.Control",multiple:true,forwarding:{idSuffix:"--innerGrid",aggregation:"items"},dnd:true}},events:{"add":{},"delete":{},"reset":{},"titleChange":{},"visualizationDrop":{parameters:{draggedControl:{type:"sap.ui.core.Control"},droppedControl:{type:"sap.ui.core.Control"},dropPosition:{type:"string"}}},"sectionVisibilityChange":{parameters:{visible:{type:"boolean"}}},"borderReached":{parameters:{event:{type:"jQuery.Event"}}}}},resourceModel:r.i18nModel});S.prototype.init=function(){this.oVBox=this.byId("content");this.byId("innerGrid").addEventDelegate({onBeforeRendering:function(){R.deregister(this._sHandleResizeId);}.bind(this),onAfterRendering:function(){this._sHandleResizeId=R.register(this.oVBox,this._handleResize.bind(this));this.oVBox.toggleStyleClass("sapUshellSectionNoVisualizations",!this.getVisualizations().length);}.bind(this)});this.addEventDelegate({onsapleft:this._handleKeyboardArrowNavigation.bind(this,false),onsapleftmodifiers:this._handleKeyboardArrowNavigation.bind(this,true),onsapright:this._handleKeyboardArrowNavigation.bind(this,false),onsaprightmodifiers:this._handleKeyboardArrowNavigation.bind(this,true),onsapup:this._handleKeyboardArrowNavigation.bind(this,false),onsapupmodifiers:this._handleKeyboardArrowNavigation.bind(this,true),onsapdown:this._handleKeyboardArrowNavigation.bind(this,false),onsapdownmodifiers:this._handleKeyboardArrowNavigation.bind(this,true),onsaphome:this._setFocusOnVisualizationWithIndex.bind(this,0),onsapend:this._setFocusOnVisualizationWithIndex.bind(this,"last")});};S.prototype._setFocusOnVisualizationWithIndex=function(i,e){e.preventDefault();e.stopPropagation();window.setTimeout(function(){var v=this.getVisualizations();if(v.length){var n=v[i==="last"?v.length-1:i],N=n.getInnerControl().getContent?n.getInnerControl().getContent()[0]:n.getInnerControl();N.focus();}}.bind(this),0);};S.prototype._handleKeyboardArrowNavigation=function(m,e){if((m&&!this.getEnableVisualizationReordering())||(m&&!e.ctrlKey)){return;}var v=this.getVisualizations();for(var i=0;i<v.length;i++){var V=v[i],I=V.getInnerControl().getContent?V.getInnerControl().getContent()[0]:V.getInnerControl();if(window.document.activeElement===I.getDomRef()){if(e.type==="sapleft"||e.type==="sapup"){if(i>0){this._setFocusOnVisualizationWithIndex(i-1,e);}else{this.fireBorderReached({event:e,section:this,direction:"up"});e.stopPropagation();}}else if(e.type==="sapright"||e.type==="sapdown"){if((i+1)<v.length){this._setFocusOnVisualizationWithIndex(i+1,e);}else{this.fireBorderReached({event:e,section:this,direction:"down"});e.stopPropagation();}}else if(e.type==="sapleftmodifiers"||e.type==="sapupmodifiers"){if(i>0){this.fireVisualizationDrop({draggedControl:this.getVisualizations()[i],droppedControl:this.getVisualizations()[i-1],dropPosition:"Before"});this._setFocusOnVisualizationWithIndex(i-1,e);}else{this.fireBorderReached({event:e,section:this,direction:"up",visualization:V});e.stopPropagation();}}else if(e.type==="saprightmodifiers"||e.type==="sapdownmodifiers"){if((i+1)<v.length){this.fireVisualizationDrop({draggedControl:this.getVisualizations()[i],droppedControl:this.getVisualizations()[i+1],dropPosition:"After"});this._setFocusOnVisualizationWithIndex(i+1,e);}else{this.fireBorderReached({event:e,section:this,direction:"down",visualization:V});e.stopPropagation();}}return;}}};S.prototype.setEditable=function(v){this.setProperty("editable",!!v);this.oVBox.toggleStyleClass("sapUshellSectionEdit",!!v);};S.prototype.setShowSection=function(v,e){this.setProperty("showSection",!!v);this.oVBox.toggleStyleClass("sapUshellSectionHidden",!v);this.fireSectionVisibilityChange({visible:!!v});};S.prototype._reorderVisualizations=function(i){this.fireVisualizationDrop(i.getParameters());};S.prototype.addAggregation=function(a,o){X.prototype.addAggregation.apply(this,arguments);if(a==="visualizations"){this._addVisualizationLayoutData(o);}return this;};S.prototype.insertAggregation=function(a,o){X.prototype.insertAggregation.apply(this,arguments);if(a==="visualizations"){this._addVisualizationLayoutData(o);}return this;};S.prototype._getVisualizationLayoutData=function(v){if(v.getLayout){return v.getLayout();}return{rows:2,columns:2};};S.prototype._addVisualizationLayoutData=function(v){if(!v.getLayoutData()){var L=this._getVisualizationLayoutData(v);v.setLayoutData(new G(L));}};S.prototype._handleResize=function(e){var i=this.byId("innerGrid");if(e.size.width<376){i.setContainerQuery(false);}else if(e.size.width>=376){i.setContainerQuery(true);}};return S;});
