// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/ui/launchpad/ActionItem","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/Device","./ContactSupportButtonRenderer"],function(r,A,a,q,L,D){"use strict";var C=a.extend("sap.ushell.ui.footerbar.ContactSupportButton",{metadata:{library:"sap.ushell"}});C.prototype.init=function(){if(a.prototype.init){a.prototype.init.apply(this,arguments);}this.setIcon("sap-icon://email");this.setText(r.i18n.getText("contactSupportBtn"));this.attachPress(this.showContactSupportDialog);this.setEnabled();};C.prototype.showContactSupportDialog=function(){sap.ui.require(["sap/ui/layout/form/SimpleForm","sap/ui/layout/form/SimpleFormLayout","sap/m/TextArea","sap/m/Link","sap/m/Label","sap/m/Text","sap/m/Dialog","sap/m/Button","sap/ushell/UserActivityLog"],function(S,b,T,c,d,e,f,B,U){var g="",u="",h="",i=[],o,j;j=function(){this.oDialog.removeContent(this.oBottomSimpleForm.getId());this.oBottomSimpleForm.destroy();if(this.oClientContext.navigationData.applicationInformation){g=this.oClientContext.navigationData.applicationInformation.applicationType;u=this.oClientContext.navigationData.applicationInformation.url;h=this.oClientContext.navigationData.applicationInformation.additionalInformation;}i.push(new e({text:this.translationBundle.getText("loginDetails")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));i.push(new d({text:this.translationBundle.getText("userFld")}));i.push(new e({text:this.oClientContext.userDetails.fullName||""}));i.push(new d({text:this.translationBundle.getText("serverFld")}));i.push(new e({text:window.location.host}));if(this.oClientContext.userDetails.eMail&&this.oClientContext.userDetails.eMail!==""){i.push(new d({text:this.translationBundle.getText("eMailFld")}));i.push(new e({text:this.oClientContext.userDetails.eMail||""}));}i.push(new d({text:this.translationBundle.getText("languageFld")}));i.push(new e({text:this.oClientContext.userDetails.Language||""}));if(this.oClientContext.shellState==="app"||this.oClientContext.shellState==="standalone"){i.push(new e({text:""}));i.push(new e({text:this.translationBundle.getText("navigationDataFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));i.push(new d({text:this.translationBundle.getText("hashFld")}));i.push(new e({text:this.oClientContext.navigationData.navigationHash||""}));i.push(new e({text:""}));i.push(new e({text:this.translationBundle.getText("applicationInformationFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));i.push(new d({text:this.translationBundle.getText("applicationTypeFld")}));i.push(new e({text:g}));i.push(new d({text:this.translationBundle.getText("urlFld")}));i.push(new e({text:u}));i.push(new d({text:this.translationBundle.getText("additionalInfoFld")}));i.push(new e({text:h}));}this.oBottomSimpleForm=new S("technicalInfoBox",{layout:b.ResponsiveLayout,content:i}).addStyleClass("sapUshellTechnicalInfoBox");if(D.os.ios&&D.system.phone){this.oBottomSimpleForm.addStyleClass("sapUshellContactSupportFixWidth");}o=this.oBottomSimpleForm.onAfterRendering;this.oBottomSimpleForm.onAfterRendering=function(){o.apply(this,arguments);var n=q(this.getDomRef());n.attr("tabIndex",0);setTimeout(function(){this.focus();}.bind(n),700);};this.oDialog.addContent(this.oBottomSimpleForm);}.bind(this);this._embedLoginDetailsInBottomForm=j;this.translationBundle=r.i18n;this.oClientContext=U.getMessageInfo();this.oLink=new c({text:this.translationBundle.getText("technicalDataLink")});this.oBottomSimpleForm=new S("bottomForm",{editable:false,content:[this.oLink]});this.sendButton=new B("contactSupportSendBtn",{text:this.translationBundle.getText("sendBtn"),enabled:false,press:function(){var s=sap.ushell.Container.getService("SupportTicket"),t=this.oTextArea.getValue(),k={text:t,clientContext:this.oClientContext},p=s.createTicket(k);p.done(function(){sap.ushell.Container.getService("Message").info(this.translationBundle.getText("supportTicketCreationSuccess"));}.bind(this));p.fail(function(){sap.ushell.Container.getService("Message").error(this.translationBundle.getText("supportTicketCreationFailed"));}.bind(this));this.oDialog.close();}.bind(this)});this.cancelButton=new B("contactSupportCancelBtn",{text:this.translationBundle.getText("cancelBtn"),press:function(){this.oDialog.close();}.bind(this)});this.oTextArea=new T("textArea",{rows:7,liveChange:function(){if(/\S/.test(this.oTextArea.getValue())){this.sendButton.setEnabled(true);}else{this.sendButton.setEnabled(false);this.oTextArea.setValue("");}}.bind(this)});this.oTopSimpleForm=new S("topForm",{editable:false,content:[this.oTextArea],layout:b.ResponsiveGridLayout});this.oDialog=new f({id:"ContactSupportDialog",title:this.translationBundle.getText("contactSupportBtn"),contentWidth:"29.6rem",leftButton:this.sendButton,rightButton:this.cancelButton,initialFocus:"textArea",afterOpen:function(){q("#textArea").on("focusout",function(){window.scrollTo(0,0);});},afterClose:function(){this.oDialog.destroy();if(window.document.activeElement&&window.document.activeElement.tagName==="BODY"){window.document.getElementById("meAreaHeaderButton").focus();}}.bind(this)}).addStyleClass("sapUshellContactSupportDialog");this.oTextArea.setPlaceholder(this.translationBundle.getText("txtAreaPlaceHolderHeader"));this.oLink.attachPress(j.bind(this));this.oDialog.addCustomData(new A({key:"aria-label",value:this.translationBundle.getText("ContactSupportArialLabel"),writeToDom:true}));this.oDialog.addContent(this.oTopSimpleForm);this.oDialog.addContent(this.oBottomSimpleForm);this.oDialog.open();}.bind(this));};C.prototype.setEnabled=function(e){if(!sap.ushell.Container){if(this.getEnabled()){L.warning("Disabling 'Contact Support' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.ContactSupportButton");}e=false;}a.prototype.setEnabled.call(this,e);};return C;});
