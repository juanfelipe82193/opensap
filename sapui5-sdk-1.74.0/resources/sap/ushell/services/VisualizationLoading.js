// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ushell/services/_VisualizationLoading/VizInstanceLocal","sap/ushell/services/_VisualizationLoading/VizInstanceDefault","sap/ushell/services/_VisualizationLoading/VizInstanceEmpty"],function(m,V,a,b){"use strict";var L=m.LoadState;var c={ABAP:"ABAP",local:"local",default:"default",card:"card",empty:"empty"};function d(){this._init.apply(this,arguments);}d.prototype._init=function(){};d.prototype.loadVisualizationData=function(){if(this.oCatalogTileRequest){return this.oCatalogTileRequest;}this.oCatalogTileRequest=sap.ushell.Container.getService("VisualizationDataProvider")._getCatalogTiles().then(function(C){this._oCatalogTiles=C;return Promise.resolve();}.bind(this)).catch(function(e){return Promise.reject(e);});return this.oCatalogTileRequest;};d.prototype.instantiateVisualization=function(v){var o,e,C;if(!v.localLoad){if(!v.vizId){return{};}if(!this._oCatalogTiles){this.loadVisualizationData();o=new b({visualizationId:v.vizId,vizType:c.empty,state:L.Loaded});o.load();return o;}C=this._oCatalogTiles[v.vizId];if(!C){o=new b({visualizationId:v.vizId,vizType:c.empty,state:L.Error});o.load();return o;}}var t=this._getPlatform(C,v);switch(t){case c.local:e=this._prepareLocalConfig(v,C);o=new V(e.oInitData);break;default:e=this._prepareDefaultConfig(v,C);o=new a(e.oInitData);break;}if(!v.deferLoading){o.load(e.oAdditionalData);}return o;};d.prototype._getPlatform=function(C,v){var t=c.default;if(C){if(C.getChip!==undefined){t=c.ABAP;}else if(C.namespace||C.tileType||C.properties||v.properties){t=c.local;}}else if(v.localLoad&&v.properties){t=c.local;}return t;};d.prototype._prepareDefaultConfig=function(v,e){var o={oInitData:{catalogTile:e,visualizationId:v.vizId,vizType:c.default}};return o;};d.prototype._prepareLocalConfig=function(v,e){var o={oInitData:{catalogTile:e,visualizationId:v.vizId,vizType:c.local}};if(v.properties){o.oAdditionalData={};o.oAdditionalData.properties=v.properties;o.oAdditionalData.mode=v.mode;o.oAdditionalData.namespace=v.namespace;o.oAdditionalData.path=v.path;o.oAdditionalData.moduleType=v.moduleType;o.oAdditionalData.moduleName=v.moduleName;o.oAdditionalData.tileType=v.tileType||"sap.ushell.ui.tile.StaticTile";o.oAdditionalData.keywords=v.keywords||[];}return o;};d.hasNoAdapter=true;return d;});
