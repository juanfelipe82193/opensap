// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/MessageBox","sap/ushell/Config","sap/ushell/resources","sap/m/Dialog","sap/m/Text","sap/m/Link","sap/m/Button","sap/m/VBox","sap/m/FormattedText","sap/ui/thirdparty/jquery","sap/m/MessageToast","sap/m/library","sap/ui/core/library"],function(M,C,r,D,T,L,B,V,F,q,a,m,c){"use strict";var b=m.DialogType;var d=c.ValueState;var e=m.FlexRendertype;function f(){var s;this.init=function(S){s=S;return this;};this.show=function(t,g,p){if(!g){q.sap.log.error("Message must not be empty.");return;}if(s&&typeof s==="function"){s(t,g,p||{});}else{this.buildMessage(t,g,p||{});}};this.buildMessage=function(t,g,p){var o={title:p.title,actions:p.actions,details:p.details,onClose:p.callback},h;switch(t){case f.Type.ERROR:var i=this.createErrorDialog(g,o);i.open();return;case f.Type.CONFIRM:if(!p.actions){h="confirm";}else{o.icon=M.Icon.QUESTION;h="show";}break;case f.Type.INFO:h="info";this.buildAndSendMessageToast(g,p.duration||3000);return;default:o={duration:p.duration||3000};h="show";break;}this.sendMessageBox(g,h,o);};this.createErrorDialog=function(g,o){function h(A){var E=document.createElement("textarea");try{E.contentEditable=true;E.readonly=false;E.innerText=A;document.documentElement.appendChild(E);if(navigator.userAgent.match(/ipad|iphone/i)){var R=document.createRange();R.selectNodeContents(E);window.getSelection().removeAllRanges();window.getSelection().addRange(R);E.setSelectionRange(0,999999);}else{q(E).select();}document.execCommand("copy");a.show(r.i18n.getText("CopyWasSuccessful"));}catch(G){a.show(r.i18n.getText("CopyWasNotSuccessful"));}finally{q(E).remove();}}function i(A){var E=new B({text:r.i18n.getText(A),press:function(){var G=o.details;if(typeof o.details==="object"){G=JSON.stringify(o.details,null,"\t");}var I=[];I.push("Title: "+(v||"-"));I.push("Message: "+(g||"-"));I.push("Details: "+(G||"-"));h(I.join("\n"));}});E.setTooltip(r.i18n.getText("CopyToClipboardBtn_tooltip"));return E;}function j(A){var E=new B({text:r.i18n.getText(A),press:function(){sap.ui.require(["sap/ushell/ui/footerbar/ContactSupportButton"],function(G){var I=new G();if(I){I.showContactSupportDialog();I.destroy();}});w.destroy();}});E.setTooltip(r.i18n.getText("contactSupportBtn_tooltip"));return E;}function k(A){switch(A){case"contactSupportBtn":return j(A);case"CopyToClipboardBtn":return i(A);default:return new B({text:r.i18n.getText(A),press:function(){w.destroy();}});}}function l(H){var A=[],y=[];if(H){A.push("contactSupportBtn");}else{A.push("okDialogBtn");}A.push("CopyToClipboardBtn");A.push("cancelDialogBtn");A.forEach(function(E){y.push(k(E));});return y;}function n(w,y){y.forEach(function(A){w.addButton(A);});}function p(z){var A=new T({text:g});if(o.details){A.addStyleClass("sapUiSmallMarginBottom");}z.addItem(A);}function t(z){var A=o.details;if(typeof o.details==="object"){A=o.details.info;}var E=new L({text:r.i18n.getText("ViewDetails"),press:function(){var G=z.indexOfItem(E);z.removeItem(G);z.insertItem(new F({htmlText:A}),G);}});z.addItem(E);}function u(){var z=new V({renderType:e.Bare});p(z);if(o.details){t(z);}return z;}var v=o.title||r.i18n.getText("error"),w=new D({state:d.Error,title:v,type:b.Message,contentWidth:"30rem"}),x=C.last("/core/extension/SupportTicket"),H=sap.ushell.Container&&x&&g!==r.i18n.getText("supportTicketCreationFailed"),y=l(H);n(w,y);var z=u();w.addContent(z);return w;};this.buildAndSendMessageToast=function(g,i){sap.ui.require(["sap/m/MessageToast"],function(a){a.show(g,{duration:i});});};this.sendMessageBox=function(g,t,o){if(M.hasOwnProperty(t)&&typeof M[t]==="function"){M[t](g,o);}else{q.sap.log.error("Unknown Message type: "+t);}};this.info=function(g,i){this.show(f.Type.INFO,g,{duration:i||3000});};this.error=function(g,t){g=(t!==undefined)?t+" , "+g:g;q.sap.log.error(g);this.show(f.Type.ERROR,g,{title:t});};this.confirm=function(g,h,t,A){this.show(f.Type.CONFIRM,g,{title:t,callback:h,actions:A});};}f.Type={INFO:0,ERROR:1,CONFIRM:2};f.hasNoAdapter=true;return f;},true);
