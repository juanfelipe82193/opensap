// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/utils","sap/ushell/utils/RestrictedJSONModel"],function(L,O,r,a,u,R){"use strict";var P=function(){this.COMPONENT_NAME="sap/ushell/services/Pages";this._oCdmServicePromise=sap.ushell.Container.getServiceAsync("CommonDataModel");this._oPagesModel=new R({pages:[]});};P.prototype._getParsedCdmPage=function(c){var p={id:c.site.identification.id||"",title:c.site.identification.title||"",description:c.site.identification.description||""};p.sections=r.getGroupIdsFromSite(c).map(function(g){var C=r.getGroupFromSite(c,g);var s={id:r.getGroupId(C)||"",title:r.getGroupTitle(C)||""};s.visualizations=r.getGroupTiles(C).reduce(function(v,o){var b=a.get(c,r.getTileVizId(o));if(!b){L.error("Tile "+o.id+" with vizId "+o.vizId+" has no matching visualization. As the tile cannot be used to start an app it is removed from the page.");}else{var d=a.getCdmParts(c,o);var V={vizId:r.getTileVizId(o)||"",vizType:a.getTypeId(b)||"",title:a.getTitle(d)||"",subTitle:a.getSubTitle(d)||"",icon:a.getIcon(d)||"",keywords:a.getKeywords(d)||[],info:a.getInfo(d)||"",target:a.getTarget(b)||{}};v.push(V);}return v;},[]);return s;});return p;};P.prototype.getModel=function(){return this._oPagesModel;};P.prototype.getPagePath=function(p){var b=this._oPagesModel.getProperty("/pages");for(var i=0;i<b.length;i+=1){if(b[i].id===p){return"/pages/"+i;}}return"";};P.prototype.loadPage=function(p){var s=this.getPagePath(p);if(s){return Promise.resolve(s);}return this._oCdmServicePromise.then(function(c){return c._getPage(p).then(function(S){var i=this._oPagesModel.getProperty("/pages/").length;var n="/pages/"+i;this._oPagesModel._setProperty(n,this._getParsedCdmPage(S));return n;}.bind(this)).catch(function(e){L.error("Pages: Failed to gather Site from CDM Service.",e,this.COMPONENT_NAME);return Promise.reject(e);}.bind(this));}.bind(this)).catch(function(e){L.error("Pages: Couldn't to resolve CDM Service.",e,this.COMPONENT_NAME);return Promise.reject(e);}.bind(this));};P.hasNoAdapter=true;return P;},true);
