/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/MessageToast","sap/m/MessageItem","sap/m/MessageView","sap/m/Button","sap/m/Dialog","sap/ui/core/MessageType","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/message/Message","sap/ui/core/IconPool"],function(M,a,b,B,D,c,F,d,e,I){"use strict";var t=this;function f(){var p;function i(P){return P.property?"( ${"+P.property+'} ? ("<p>'+P.property.substr(Math.max(P.property.lastIndexOf("/"),P.property.lastIndexOf("."))+1)+' : " + '+"${"+P.property+'} + "<p/>") : "" )':"";}function l(P){var H="";if(P.groupName&&P.property&&P.groupName!==p){H+="( ${"+P.property+'} ? "<br/><h3>'+P.groupName+'</h3>" : "" ) + ';p=P.groupName;}return H;}function n(){var T="technicalDetails";return[{"groupName":"","property":T+"/status"},{"groupName":"","property":T+"/statusText"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ComponentId"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ServiceId"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ServiceRepository"},{"groupName":"Application","property":T+"/error/@SAP__common.Application/ServiceVersion"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ErrorResolution/Analysis"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ErrorResolution/Note"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ErrorResolution/DetailedNote"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.ExceptionCategory"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.TimeStamp"},{"groupName":"ErrorResolution","property":T+"/error/@SAP__common.TransactionId"},{"groupName":"Messages","property":T+"/error/code"},{"groupName":"Messages","property":T+"/error/message"}];}var H="Object.keys("+"${technicalDetails}"+').length > 0 ? "<h2>Technical Details</h2>" : "" ';n().forEach(function(P){H=H+l(P)+""+i(P)+" + ";});return H;}function g(){var H="(${"+'description} ? ("<h2>Description</h2>" + ${'+'description}) : "")';return H;}function G(l){var n=c.None,L=l.length,o={Error:0,Warning:0,Success:0,Information:0};for(var i=0;i<L;i++){++o[l[i].getType()];}if(o[c.Error]>0){n=c.Error;}else if(o[c.Warning]>0){n=c.Warning;}else if(o[c.Success]>0){n=c.Success;}else if(o[c.Information]>0){n=c.Information;}return n;}function s(C){var u=j(),o=sap.ui.getCore().getMessageManager(),H;if(u.length===0&&!C){return Promise.resolve(true);}else if(u.length===1&&u[0].getType()===c.Success&&!C){return new Promise(function(i,l){M.show(u[0].message);o.removeMessages(u);});}else{return new Promise(function(i,l){t.resolve=i;sap.ui.getCore().getLibraryResourceBundle("sap.fe.core",true).then(function(R){t.oMessageTemplate=t.oMessageTemplate||new a({counter:"{counter}",title:"{message}",subtitle:"{additionalText}",longtextUrl:"{descriptionUrl}",type:"{type}",description:"{= ${"+"description} || ${technicalDetails} ? "+'"<html><body>" + '+g()+" + "+f()+'"</body></html>"'+' : "" }',markupDescription:true});t.oMessageView=t.oMessageView||new b({showDetailsPageHeader:false,itemSelect:function(){t.oBackButton.setVisible(true);},items:{path:"/",filters:[new F("target",d.EQ,""),new F("code",d.NE,undefined)],template:t.oMessageTemplate}});t.oBackButton=t.oBackButton||new B({icon:I.getIconURI("nav-back"),visible:false,press:function(){t.oMessageView.navigateBack();this.setVisible(false);}});if(C&&C.length){C.map(function(n){o.addMessages(new e({message:n.text,type:n.type,target:"",persistent:true}));});}t.oMessageView.setModel(o.getMessageModel());t.oDialog=t.oDialog||new D({resizable:true,content:t.oMessageView,beginButton:new B({press:function(){t.oDialog.close();t.oBackButton.setVisible(false);r();},text:R.getText("SAPFE_CLOSE")}),customHeader:new sap.m.Bar({contentMiddle:[new sap.m.Text({text:R.getText("SAPFE_ERROR_MESSAGES_PAGE_TITLE")})],contentLeft:[t.oBackButton]}),contentWidth:"37.5em",contentHeight:"21.5em",verticalScrolling:false,afterClose:function(E){t.resolve();}});H=G(t.oMessageView.getItems());t.oDialog.setState(H);t.oDialog.getCustomHeader().getContentMiddle()[0].setText(H!==c.None?H:R.getText("SAPFE_ERROR_MESSAGES_PAGE_TITLE"));t.oMessageView.navigateBack();t.oDialog.open();});});}}function r(){k(false);}function h(){k(true);}function j(l,T){var o=sap.ui.getCore().getMessageManager(),n=o.getMessageModel(),p=n.getObject("/"),q=[];for(var i=0;i<p.length;i++){if((!T||p[i].persistent)&&((l&&p[i].target!=="")||p[i].target==="")&&p[i].code){q.push(p[i]);}}return q;}function k(i){var l=j(i,true);if(l.length>0){sap.ui.getCore().getMessageManager().removeMessages(l);}}var m={showUnboundMessages:s,removeUnboundTransitionMessages:r,removeBoundTransitionMessages:h};return m;});
