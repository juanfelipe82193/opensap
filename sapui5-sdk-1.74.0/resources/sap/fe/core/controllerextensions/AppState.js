/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/model/json/JSONModel","sap/ui/core/routing/HashChanger","sap/fe/core/controllerextensions/AppState","sap/fe/core/CommonUtils"],function(C,J,H,A,a){"use strict";var E=C.extend("sap.fe.core.controllerextensions.AppState",{initializeAppState:function(o){var t=this;var r=o.getRouter();var b=(A.mAppContainer[o.getId()]={appStateModels:{}});b.oInnerAppStatePromise=new jQuery.Deferred();r.attachRouteMatched(function(e){var q=e.getParameters().arguments["?query"];var s=q&&q["sap-iapp-state"];if(s){if(b.oAppState&&s===b.oAppState.getKey()){b.oInnerAppStatePromise.resolve();s=undefined;}if(s){sap.ushell.Container.getService("CrossApplicationNavigation").getAppState(o,s).done(function(S){b.oAppState=S;t._updateAppStateModels(b,S);b.oInnerAppStatePromise.resolve();});}}else{b.oInnerAppStatePromise.resolve();if(b.oAppState){b.oAppState=null;t._updateAppStateModels(b,null);}}});},cleanupAppState:function(o){if(A.mAppContainer[o.getId()]){delete A.mAppContainer[o.getId()];}},requestAppStateModel:function(i){var t=this;var o=this._getAppContainer(),b;return o.oInnerAppStatePromise.then(function(){if(!o.appStateModels[i]){o.appStateModels[i]=new J(null,true);o.appStateModels[i].bindList("/").attachChange(t._updateAppState.bind(t,i));}if(o.oAppState){b=o.oAppState.getData();if(b&&b[i]){o.appStateModels[i].setData(b[i]);}}return o.appStateModels[i];});},_updateAppState:function(i){var o={};var b=this._getAppContainer();var n=b.appStateModels[i].getJSON();if(b.oAppState){o=b.oAppState.getData()||{};}if(o&&o[i]&&o[i]===n){return;}b.oAppState=sap.ushell.Container.getService("CrossApplicationNavigation").createEmptyAppState(this._getOwnerComponent());var h=this._getHashChanger();var c=h.getAppHash();var p=c.split("?");var s=p[0];s+="?sap-iapp-state="+b.oAppState.getKey();h.replaceHash(s);o[i]=n;b.oAppState.setData(o);return b.oAppState.save();},_getHashChanger:function(){if(!this.oHashChanger){this.oHashChanger=H.getInstance();}return this.oHashChanger;},_getOwnerComponent:function(){return a.getAppComponent(this.base.getView());},_updateAppStateModels:function(o,b){var d=(b&&b.getData())||{};for(var p in o.appStateModels){if(d&&d[p]){o.appStateModels[p].setData(d[p]);}else{o.appStateModels[p].setData(null);}}},_getAppContainer:function(){return A.mAppContainer[this._getOwnerComponent().getId()];}});A.mAppContainer={};return E;});
