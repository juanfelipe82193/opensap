/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/fe/core/controllerextensions/Transaction","sap/fe/core/controllerextensions/Routing","sap/fe/core/controllerextensions/EditFlow","sap/fe/macros/field/FieldRuntime","sap/fe/macros/CommonHelper","sap/fe/core/AnnotationHelper","sap/fe/core/actions/messageHandling","sap/base/Log","sap/base/util/ObjectPath","sap/fe/navigation/SelectionVariant","sap/m/MessageBox","sap/fe/core/CommonUtils","sap/fe/navigation/NavigationHelper"],function(C,J,T,R,E,F,a,A,m,L,O,S,M,b,N){"use strict";return C.extend("sap.fe.templates.ListReport.ListReportController",{transaction:T,routing:R,editFlow:E,messageHandling:m,onInit:function(){this.getView().setModel(new J(),"sap.fe.templates.ListReport");this.getView().setModel(this.editFlow.getUIStateModel(),"ui");this.getView().setModel(new J({sessionOn:false}),"localUI");this.filterBarConditions={};},onExit:function(){var v=this.getView();v.getModel("sap.fe.templates.ListReport").destroy();v.getModel("ui").destroy();v.getModel("localUI").destroy();delete this.filterBarConditions;delete this._oListReportControl;},onAfterBinding:function(B,p){if(this.routing.isUIStateDirty()){var t=this.getTableBinding();if(t){t.refresh();}this.routing.setUIStateProcessed();}},onPageReady:function(p){var v=this.getView();if(p&&p.lastFocusControl){var f=v.byId(p.lastFocusControl.controlId);if(f){f.applyFocusInfo(p.lastFocusControl.focusInfo);}}},getPageTitleInformation:function(){var t=this;return new Promise(function(r,c){var o={title:"",subtitle:"",intent:"",icon:""};o.title=t.getView().getContent()[0].data().ListReportTitle;o.subtitle=t.getView().getContent()[0].data().ListReportSubtitle;r(o);});},_getTableControlId:function(){return this.getView().getContent()[0].data("reportTableId");},_getTableControl:function(){if(!this._oListReportControl){this._oListReportControl=this.getView().byId(this._getTableControlId());}return this._oListReportControl;},_initializeTableBinding:function(){var t=this._getTableControl();if(!this._bBindingInitialized){if(!t){this.getView().attachEventOnce("modelContextChange",this.initializeTableBinding,this);}else{t.done().then(t.rebindTable.bind(t));this._bBindingInitialized=true;}}},getTableBinding:function(){var t=this._getTableControl(),B=t&&t._getRowBinding();if(!B){this._initializeTableBinding();}return B;},_getMergedContext:function(c,f){var o,s;o=N.addConditionsToSelectionVariant(new S(),f);s=N.mixAttributesAndSelectionVariant(c.getObject(),o);return N.removeSensitiveData(c,s);},setShareModel:function(){var g=O.get("sap.ushell.Container.getUser");var s={bookmarkTitle:document.title,bookmarkCustomUrl:function(){var h=hasher.getHash();return h?"#"+h:window.location.href;},isShareInJamActive:!!g&&g().isJamActive()};var t=this.getOwnerComponent().getModel("_templPriv");t.setProperty("/listReport/share",s);},handlers:{onShareListReportActionButtonPress:function(e){var g=this.getView().getModel("sap.fe.i18n").getResourceBundle();if(!this._oShareActionButton){this._oShareActionButton=sap.ui.xmlfragment("sap.fe.templates.ListReport.ShareSheet",{shareEmailPressed:function(){g.then(function(B){sap.m.URLHelper.triggerEmail(null,B.getText("SAPFE_EMAIL_SUBJECT",[document.title]),document.URL);});},shareJamPressed:function(){}});this.getView().addDependent(this._oShareActionButton);}this._oShareActionButton.openBy(e.getSource());},onFiltersChanged:function(e){var f=e.getSource(),l=f.data("listBindingNames"),o=this.getView().byId(l);if(o&&o.isTableBound()&&!o._oTable.getShowOverlay()){o._oTable.setShowOverlay(true);o._getRowBinding().attachEventOnce("dataReceived",o._oTable.setShowOverlay.bind(o._oTable,false));}},onSearch:function(e){var B=this.getTableBinding(),f=e.getSource(),o=f.getFilters(),s=f.getSearch()||undefined;this.filterBarConditions=e.getParameter("conditions");a.filterAggregation(B,o,s);},onFieldValueChange:function(e){this.editFlow.syncTask(e.getParameter("promise"));F.handleChange(e);},onDataFieldForIntentBasedNavigation:function(c,s,d,v){var o;if(v){if(v.length>1){var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates");M.error(r.getText("NAVIGATION_DISABLED_MULTIPLE_CONTEXTS"),{title:"Error"});return;}else if(v.length===1){o=c._getMergedContext(v[0],c.filterBarConditions);}}a.navigateToExternalApp(c.getView(),o,s,d);},onChevronPressNavigateOutBound:function(c,o,d){var e=c.routing.getOutbounds(),s,D=e[o];if(D){if(d){s=c._getMergedContext(d,c.filterBarConditions);}a.navigateToExternalApp(c.getView(),s,D.semanticObject,D.action,a.showNavigateErrorMessage);return Promise.resolve();}else{throw new Error("outbound target "+o+" not found in cross navigation definition of manifest");}}}});});
