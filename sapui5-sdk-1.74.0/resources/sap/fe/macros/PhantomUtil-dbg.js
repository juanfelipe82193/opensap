/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/base/ManagedObject","sap/fe/macros/ResourceModel","sap/ui/core/util/XMLPreprocessor","sap/ui/base/SyncPromise","./TraceInfo"],function(J,M,R,X,S,T){"use strict";var i=R.getModel();i.bindContext=i.bindContext||function(){return{initialize:function(){},attachChange:function(){},detachChange:function(){},attachEvents:function(){},detachEvents:function(){},updateRequired:function(){},destroy:function(){},getContext:function(){}};};function v(n,C,o,k){var d,e;if(!C[k]){if(o.required){throw new Error(n+": "+"Required metadataContext '"+k+"' is missing");}}else{d=C[k];e=d.getObject();if(e){Object.keys(o).forEach(function(P){var f=Array.isArray(o[P])?o[P]:[o[P]],V;if(P!=="required"&&P!=="type"){if(typeof e==="object"){V=e[P];if(!V){if(e.hasOwnProperty("$Path")){V=d.getObject("$Path/"+P);}}}else if(typeof e==="string"){V=d.getObject(P);if(!V){V=f[0];}}else{V=null;}if(f.indexOf(V)===-1){throw new Error(n+": '"+k+"' must be '"+P+"' '"+f+"' but is '"+V+"': "+d.getPath());}}});}}}function a(n,m,C,N){var d=(m.metadataContexts&&Object.keys(m.metadataContexts))||[],P=(m.properties&&Object.keys(m.properties))||[];d.forEach(function(k){var o=m.metadataContexts[k];v(n,C,o,k);});P.forEach(function(k){var o=m.properties[k];if(!N.hasAttribute(k)){if(o.hasOwnProperty("defaultValue")){N.setAttribute(k,o.defaultValue);}else if(o.required){throw new Error(n+": "+"Required property '"+k+"' is missing");}}});}function p(m){if(m){var P={};var o=m.metadataContexts||{};Object.keys(m.properties).forEach(function(s){if(m.properties[s].type!=="sap.ui.model.Context"){P[s]=m.properties[s];}else{o[s]=m.properties[s];}});return{properties:P,metadataContexts:o};}else{return{metadataContexts:{},properties:{},events:{}};}}function w(k){return function(V){var o={};o[k]=V;return o;};}function g(n,k){return function(){return w(k)(n.getAttribute(k));};}function r(m,n,V){var f=m.fragment||m.namespace+"."+m.name,N="this",I=N+".i18n",C={},A=new J(n),s=n.getAttribute("metadataContexts"),o={},d=V.getSettings(),j;var e=p(m.metadata);A._getObject=function(P,z){if((P===undefined||P==="")&&this.oProps){return this.oProps;}if(this.oProps&&this.oProps.hasOwnProperty(P)){return this.oProps[P];}return n.getAttribute(P);};A.getContextName=function(){return N;};A.$$valueAsPromise=true;C[I]=i.getContext("/");if(!d[f]){d[f]={};}var t=null;var h=true;if(m.hasValidation){var D=e.properties;var k=e.metadataContexts;var l=Object.keys(D);var q=Object.keys(k);var u=[];for(j=0;j<l.length;j++){var K=l[j];if(n.hasAttribute(K)){u.push(V.visitAttribute(n,n.attributes[K]).then(g(n,K)));}else{var O={};O[K]=D[K].defaultValue;u.push(Promise.resolve(O));}}h=false;for(j=0;j<q.length;j++){if(n.hasAttribute(q[j])){var x=n.getAttribute(q[j]);V.getResult(x,n);var y=M.bindingParser(x);y.name=q[j];b(C,V,y,o);u.push(Promise.resolve(w(q[j])(C[q[j]])));}else{h=true;}}t=S.all(u);}else{t=V.visitAttributes(n);}return t.then(function(P){if(P!=null){var z=P.reduce(function(B,E){return Object.assign(B,E);},{});if(m.create){z=m.create(z);}A.oProps=z;}if(h&&s){o=s?M.bindingParser(s):{parts:[]};if(!o.parts){o={parts:[o]};}for(j=0;j<o.parts.length;j++){b(C,V,o.parts[j],o);V=V["with"](C,false);}}}).then(function(){var P;C[N]=A.getContext("/");if(T.isTraceInfoActive()){var z=T.traceMacroCalls(f,e,C,n,V);if(z){P=d["_macroInfo"];d["_macroInfo"]=z.macroInfo;}}a(f,e,C,n);var B=V["with"](C,true);return B.insertFragment(f,n).then(function(){if(P){d["_macroInfo"]=P;}else{delete d["_macroInfo"];}});});}function b(C,V,o,m){var k=o.name||o.model||undefined;if(m[k]){return;}try{var s=o.path;if(o.model!=null){s=o.model+">"+s;}C[k]=V.getContext(s);m[k]=C[k];}catch(e){}}function c(m){X.plugIn(r.bind(this,m),m.namespace,m.name);}c._validateMacroSignature=a;return{register:c};});
