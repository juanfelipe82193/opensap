/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/base/Log","./StableIdHelper","sap/ui/mdc/condition/ConditionModel","sap/fe/core/CommonUtils","sap/fe/navigation/SelectionVariant"],function(R,O,L,S,C,a,b){"use strict";var H={isVisible:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),h=A["@com.sap.vocabularies.UI.v1.Hidden"];return typeof h==="object"?"{= !${"+h.$Path+"} }":!h;},getParameterEditMode:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),f=A["@com.sap.vocabularies.Common.v1.FieldControl"],c=A["@Org.OData.Core.V1.Immutable"],d=A["@Org.OData.Core.V1.Computed"];if(f&&f.$Path){if(f.$Path==="ReadOnly"){return sap.ui.mdc.EditMode.ReadOnly;}else{return("{= %{"+f.$Path+"} ? "+"'"+sap.ui.mdc.EditMode.ReadOnly+"'"+" : "+"'"+sap.ui.mdc.EditMode.Editable+"'"+" }");}}if(f&&f.$EnumMember){if(f.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){return sap.ui.mdc.EditMode.ReadOnly;}}if(c||d){return sap.ui.mdc.EditMode.ReadOnly;}return sap.ui.mdc.EditMode.Editable;},getMetaPath:function(t,i){return(i&&i.context&&i.context.getPath())||undefined;},getStableId:S.generate,getTargetCollection:function(c,n){var p=c.getPath(),P,e,d;if(c.getMetadata().getName()==="sap.ui.model.Context"&&c.getObject("$kind")==="EntitySet"){return p;}if(c.getModel){p=(c.getModel().getMetaPath&&c.getModel().getMetaPath(p))||c.getModel().getMetaModel().getMetaPath(p);}P=p.split("/").filter(Boolean);e="/"+P[0];if(P.length===1){return e;}d=typeof n==="undefined"?P[P.length-1]:n;return e+"/$NavigationPropertyBinding/"+d;},isPropertyFilterable:function(p,i){var e,P,I=false,m=i.context.getModel(),s=i.context.getPath();if(m.getObject(s+"@com.sap.vocabularies.UI.v1.Hidden")){return false;}if(m.getObject(s+"@com.sap.vocabularies.UI.v1.HiddenFilter")){return false;}e=H._getEntitySetPath(m,s);if(typeof p==="string"){P=p;}else{P=m.getObject(s+"@sapui.name");}if(P.indexOf("/")<0){I=H._isInNonFilterableProperties(m,e,P);}else{I=H._isContextPathFilterable(m,e,P);}return!I;},_isInNonFilterableProperties:function(m,e,c){var i=false;var A=m.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(A&&A.NonFilterableProperties){i=A.NonFilterableProperties.some(function(p){return p.$NavigationPropertyPath===c||p.$PropertyPath===c;});}return i;},_isContextPathFilterable:function(m,e,c){var d=c.split("/"),i=false,s="";d.some(function(f,g,h){if(s.length>0){s+="/"+f;}else{s=f;}if(g===h.length-1){i=H._isInNonFilterableProperties(m,e,s);}else if(m.getObject(e+"/$NavigationPropertyBinding/"+f)){i=H._isInNonFilterableProperties(m,e,s);s="";e="/"+m.getObject(e+"/$NavigationPropertyBinding/"+f);}return i===true;});return i;},replaceSpecialCharsInId:function(i){if(i.indexOf(" ")>=0){L.error("Annotation Helper: Spaces are not allowed in ID parts. Please check the annotations, probably something is wrong there.");}return i.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");},formatDraftLockText:function(I,c,d){if(!I){return R.getText("draft.DRAFT_OBJECT");}else if(c){if(d){return R.getText("draft.LOCKED_OBJECT");}else{return R.getText("draft.UNSAVED_CHANGES");}}else{return"";}},_getEntitySetPath:function(m,p){var l;var e=p.slice(0,p.indexOf("/",1));if(m.getObject(e+"/$kind")==="EntityContainer"){l=e.length+1;e=p.slice(l,p.indexOf("/",l));}return e;},_resolveValueHelpField:function(c){var v=c.getModel();var V=v.getObject("/");return V.$model.getMetaModel().createBindingContext("/"+V.CollectionPath+"/"+c.getObject());},getBoolAnnotationValue:function(A){var v=A||false;v=v===true||(v&&v["Bool"]!=="false");return v;},gotoTargetEntitySet:function(c){var p=H.getTargetCollection.call(H,c);return p+"/$";},gotoActionParameter:function(c){var p=c.getPath(),P=c.getObject(p+"/$Name"),d=p.indexOf("@$ui5.overload")>-1?p.split("@$ui5.overload"):p.split("0");return d[0]+P;},navigateToExternalApp:function(v,s,c,A,o){s=s?s:new b();var n=s.toJSONString();var d=a.getAppComponent(v);d.getService("navigation").then(function(N){N.navigate(c,A,n,undefined,o);});},showNavigateErrorMessage:function(e){sap.m.MessageBox.show(R.getText("navigation.ERROR_MESSAGE"),{title:R.getText("navigation.ERROR_TITLE")});},getEntitySetName:function(m,e){var E=m.getObject("/");for(var k in E){if(typeof E[k]==="object"&&E[k].$Type===e){return k;}}},getActionPath:function(A,r,s,c){s=!s?A.getObject(A.getPath()):s;var e=A.getPath().split("/@")[0];e=A.getObject(e).$Type;e=this.getEntitySetName(A.getModel(),e);if(c){return A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable");}if(r){return"/"+e+"/"+s;}else{return{sEntityName:e,sProperty:A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable/$Path"),sBindingParameter:A.getObject("/"+e+"/"+s+"/@$ui5.overload/0/$Parameter/0/$Name")};}},getEditMode:function(A,d,f,D,e,c,p,r,s,u){if(s){return false;}if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return e;}var g,i,h,j,E,k,F,l,m,I,n;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(A&&A["@com.sap.vocabularies.Common.v1.SemanticObject"]&&!(A["@com.sap.vocabularies.Common.v1.ValueListReferences"]||A["@com.sap.vocabularies.Common.v1.ValueListMapping"]||A["@com.sap.vocabularies.Common.v1.ValueList"]||A["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]))){return"Display";}if(A&&A["@Org.OData.Core.V1.Computed"]){g=A["@Org.OData.Core.V1.Computed"].Bool?A["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(A&&A["@Org.OData.Core.V1.Immutable"]){i=A["@Org.OData.Core.V1.Immutable"].Bool?A["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}h=g||i;c="$"+c;m=typeof g==="undefined"?typeof i==="undefined"||i:!g;if(f){if(f.indexOf("{")===0){I="$"+f+" === '1'";n="$"+f+" === '0'";}else{h=h||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}}var o;var q;var t;if(p==="Form"){if(m){q=e==="Editable"?c+" ? 'Editable' : 'ReadOnly'":"$"+e+" === 'Editable' ? "+c+"? 'Editable' : 'ReadOnly'  : 'Display'";t=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}else{q=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly' : 'Display'";t=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}}else{q="'Display'";t="'Display'";}k=e&&e.indexOf("{")===0?"$"+e:"'"+e+"'";if(h){if(!m||!D){if(e&&e.indexOf("{")===0&&p==="Form"){return r?false:"{= "+q+"}";}q=q.split("'")&&q.split("'")[1];return r?false:q;}else{if(I){return("{= !%{IsActiveEntity} && !%{HasActiveEntity} ? ("+n+"? "+(r?"false":"Disabled")+" : "+I+"? "+(r?"false":"ReadOnly")+" : "+(r?"${ui>/editable} === 'Editable'":k)+") : "+(r?"false":q)+"}");}else if(f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){k="'ReadOnly'";}return("{= !%{IsActiveEntity} && !%{HasActiveEntity} ?"+(r?"${ui>/editable} === 'Editable'":k)+" : "+(r?"false":q)+"}");}}if(I){if(u){k="$"+u+" === '1' ? 'EditableReadOnly' : "+k;}j=n+" ? "+(r?"false":t)+" :"+I+" ? "+(r?"false":q)+" :"+(r?"${ui>/editable} === 'Editable'":k);o="{= "+j+"}";}else if(u){F="$"+u+" === '1'";l=e==="Editable"?"'EditableReadOnly'":"$"+e+" === 'Editable' ? 'EditableReadOnly' : 'Display'";j=F+" ? "+l+" :"+k;o="{= "+j+"}";}else{j=k;o=r?"{= ${ui>/editable} === 'Editable'}":e;}E=m||!D?o:"{= !%{IsActiveEntity} && !%{HasActiveEntity} ? "+(r?"false":q)+" : "+j+"}";return E;},getNavigationContext:function(c){return O.getNavigationPath(c.getPath());},filterAggregation:function(l,f,s){if(!l){return;}if(!l.isSuspended()){l.suspend();}if(l.changeParameters){l.changeParameters({$search:s});}l.filter(f);l.resume();}};H.isPropertyFilterable.requiresIContext=true;return H;},true);
