<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta charset="UTF-8">

	<title>Testpage - sap.suite.ui.microchart.LineMicroChart</title>

	<base href="../../../../../">
	<script id="sap-ui-bootstrap"
			data-sap-ui-libs="sap.ui.layout,sap.suite.ui.microchart"
			data-sap-ui-theme="sap_belize"
			src="resources/sap-ui-core.js">
	</script>

	<script id="myXml" type="text/xmldata">

		<mvc:View
				controllerName="myController"
				xmlns:core="sap.ui.core"
				xmlns:layout="sap.ui.layout"
				xmlns:f="sap.ui.layout.form"
				xmlns:smartField="sap.ui.comp.smartfield"
				xmlns:mvc="sap.ui.core.mvc"
				xmlns:mc="sap.suite.ui.microchart"
				xmlns="sap.m">

			<Label text="Controls in different sizes" width="100%" textAlign="Center" design="Bold"/>
			<layout:ResponsiveFlowLayout class="sapUiSmallMargin">
				<mc:LineMicroChart size="L" lines="{path:'/lines', templateShareable:'true'}" press="fnPress" class="sapUiSmallMargin"
								   minXValue="{/minXValue}" maxXValue="{/maxXValue}" showThresholdLine="{/showThresholdLine}" thresholdDisplayValue="{/thresholdDisplayValue}"
								   minYValue="{/minYValue}" maxYValue="{/maxYValue}" threshold="{/threshold}" showThresholdValue="{/showThresholdValue}"
								   color="{/color}" leftTopLabel="{/leftTopLabel}" rightTopLabel="{/rightTopLabel}"
								   leftBottomLabel="{/leftBottomLabel}" rightBottomLabel="{/rightBottomLabel}" showPoints="{/showPoints}">
					<mc:lines>
						<mc:LineMicroChartLine points="{path: 'points', factory: '.fnPointsFactory'}" showPoints="{showPoints}" color="{color}" type="{type}"/>
					</mc:lines>
				</mc:LineMicroChart>
				<mc:LineMicroChart size="M" lines="{path:'/lines', templateShareable:'true'}" press="fnPress" class="sapUiSmallMargin"
								   minXValue="{/minXValue}" maxXValue="{/maxXValue}" showThresholdLine="{/showThresholdLine}" thresholdDisplayValue="{/thresholdDisplayValue}"
								   minYValue="{/minYValue}" maxYValue="{/maxYValue}" threshold="{/threshold}" showThresholdValue="{/showThresholdValue}"
								   color="{/color}" leftTopLabel="{/leftTopLabel}" rightTopLabel="{/rightTopLabel}"
								   leftBottomLabel="{/leftBottomLabel}" rightBottomLabel="{/rightBottomLabel}"  showPoints="{/showPoints}">
					<mc:lines>
						<mc:LineMicroChartLine points="{path: 'points', factory: '.fnPointsFactory'}" showPoints="{showPoints}" color="{color}" type="{type}"/>
					</mc:lines>
				</mc:LineMicroChart>
				<mc:LineMicroChart size="S" lines="{path:'/lines', templateShareable:'true'}" press="fnPress" class="sapUiSmallMargin"
								   minXValue="{/minXValue}" maxXValue="{/maxXValue}" showThresholdLine="{/showThresholdLine}" thresholdDisplayValue="{/thresholdDisplayValue}"
								   minYValue="{/minYValue}" maxYValue="{/maxYValue}" threshold="{/threshold}" showThresholdValue="{/showThresholdValue}"
								   color="{/color}" leftTopLabel="{/leftTopLabel}" rightTopLabel="{/rightTopLabel}"
								   leftBottomLabel="{/leftBottomLabel}" rightBottomLabel="{/rightBottomLabel}"  showPoints="{/showPoints}">
					<mc:lines>
						<mc:LineMicroChartLine points="{path: 'points', factory: '.fnPointsFactory'}" showPoints="{showPoints}" color="{color}" type="{type}"/>
					</mc:lines>
				</mc:LineMicroChart>
				<mc:LineMicroChart size="XS" lines="{path:'/lines', templateShareable:'true'}" press="fnPress" class="sapUiSmallMargin"
								   minXValue="{/minXValue}" maxXValue="{/maxXValue}" showThresholdLine="{/showThresholdLine}" thresholdDisplayValue="{/thresholdDisplayValue}"
								   minYValue="{/minYValue}" maxYValue="{/maxYValue}" threshold="{/threshold}" showThresholdValue="{/showThresholdValue}"
								   color="{/color}" leftTopLabel="{/leftTopLabel}" rightTopLabel="{/rightTopLabel}"
								   leftBottomLabel="{/leftBottomLabel}" rightBottomLabel="{/rightBottomLabel}"  showPoints="{/showPoints}">
					<mc:lines>
						<mc:LineMicroChartLine points="{path: 'points', factory: '.fnPointsFactory'}" showPoints="{showPoints}" color="{color}" type="{type}"/>
					</mc:lines>
				</mc:LineMicroChart>
			</layout:ResponsiveFlowLayout>

			<Label text="Sample control" width="100%" textAlign="Center" design="Bold"/>
			<FlexBox class="sapUiSmallMargin" width="100%" height="150px" renderType="Bare">
				<mc:LineMicroChart size="{/size}" lines="{path:'/lines', templateShareable:'true'}" press="fnPress" class="sapUiSmallMargin"
								   minXValue="{/minXValue}" maxXValue="{/maxXValue}" showThresholdLine="{/showThresholdLine}" thresholdDisplayValue="{/thresholdDisplayValue}"
								   minYValue="{/minYValue}" maxYValue="{/maxYValue}" threshold="{/threshold}" showThresholdValue="{/showThresholdValue}"
								   color="{/color}" leftTopLabel="{/leftTopLabel}" rightTopLabel="{/rightTopLabel}"
								   leftBottomLabel="{/leftBottomLabel}" rightBottomLabel="{/rightBottomLabel}"  showPoints="{/showPoints}">
					<mc:lines>
						<mc:LineMicroChartLine points="{path: 'points', factory: '.fnPointsFactory'}" showPoints="{showPoints}" color="{color}" type="{type}"/>
					</mc:lines>
				</mc:LineMicroChart>
			</FlexBox>

			<Label text="Settings" width="100%" textAlign="Center" design="Bold"/>
			<layout:ResponsiveFlowLayout class="sapUiSmallMargin">
				<VBox>
					<Label text="Size"/>
					<Select selectedKey="{/size}" width="10rem">
						<core:Item key="Auto" text="Auto" />
						<core:Item key="L" text="L" />
						<core:Item key="M" text="M" />
						<core:Item key="S" text="S" />
						<core:Item key="XS" text="XS" />
						<core:Item key="Responsive" text="Responsive" />
					</Select>
					<Label text="Threshold"/>
					<Input type="Number" value="{path:'/threshold', type:'sap.ui.model.type.Float'}" width="10rem"/>
					<Label text="Threshold display value"/>
					<Input value="{path:'/thresholdDisplayValue'}" width="10rem"/>
					<Label text="Show threshold line"/>
					<CheckBox selected="{path:'/showThresholdLine'}" select="fnRefresh"/>
					<Label text="Show threshold value"/>
					<CheckBox selected="{path:'/showThresholdValue'}" select="fnRefresh"/>
				</VBox>
				<VBox>
					<Label text="Min X Value"/>
					<Input type="Number" value="{path:'/minXValue', type:'sap.ui.model.type.Integer'}" width="10rem"/>
					<Label text="Max X Value"/>
					<Input type="Number" value="{path: '/maxXValue', type:'sap.ui.model.type.Integer'}" width="10rem"/>
					<Label text="Min Y Value"/>
					<Input type="Number" value="{path: '/minYValue', type:'sap.ui.model.type.Integer'}" width="10rem"/>
					<Label text="Max Y Value"/>
					<Input type="Number" value="{path: '/maxYValue', type:'sap.ui.model.type.Integer'}" width="10rem"/>
				</VBox>
				<VBox>
					<Label text="Left-Top Label"/>
					<Input value="{path:'/leftTopLabel'}" width="10rem"/>
					<Label text="Right-Top Label"/>
					<Input value="{path:'/rightTopLabel'}" width="10rem"/>
					<Label text="Left-Bottom Label"/>
					<Input value="{path:'/leftBottomLabel'}" width="10rem"/>
					<Label text="Right-Bottom Label"/>
					<Input value="{path:'/rightBottomLabel'}" width="10rem"/>
				</VBox>
			</layout:ResponsiveFlowLayout>

			<Label text="Lines" width="100%" textAlign="Center" design="Bold"/>
			<Button text="Add New line" press="fnAddLine"/>

			<FlexBox items="{path:'/lines', templateShareable:true}" width="auto" wrap="Wrap">
				<items>
					<HBox renderType="Bare" width="80%">
						<Table items="{path:'points', templateShareable:true}" width="auto">
							<columns>
								<Column>
									<Text text="x"/>
								</Column>
								<Column>
									<Text text="y"/>
								</Column>
								<Column>
									<Text text="emphasized"/>
								</Column>
								<Column>
									<Text text="show"/>
								</Column>
								<Column>
									<Text text="color"/>
								</Column>
								<Column>
									<Button text="add point" press="fnAddPoint"/>
								</Column>
							</columns>
							<items>
								<ColumnListItem>
									<cells>
										<Input type="Number" value="{path:'x', type:'sap.ui.model.type.Integer'}" width="10rem" change="fnRefresh"/>
										<Input type="Number" value="{path:'y', type:'sap.ui.model.type.Integer'}" width="10rem" change="fnRefresh"/>
										<CheckBox selected="{path:'emphasized'}" select="fnRefresh"/>
										<CheckBox selected="{path:'show'}" select="fnRefresh" enabled="{emphasized}"/>
										<Input value="{path:'color'}" change="fnRefresh" enabled="{emphasized}" width="10rem" />
										<Button text="remove" press="fnRemoveObject"/>
									</cells>
								</ColumnListItem>
							</items>
						</Table>
						<VBox width="auto">
							<Button text="Remove line" press="fnRemoveObject"/>
							<Label text="Color"/>
							<Input value="{path:'color'}" width="10rem"/>
							<Label text="Show points"/>
							<CheckBox selected="{path:'showPoints'}" select="fnRefresh"/>
							<Label text="Type"/>
							<Select selectedKey="{type}" width="10rem">
								<core:Item key="Solid" text="Solid" />
								<core:Item key="Dashed" text="Dashed" />
								<core:Item key="Dotted" text="Dotted" />
							</Select>
						</VBox>
					</HBox>
				</items>
			</FlexBox>

		</mvc:View>

	</script>

	<script type="text/javascript">
		sap.ui.require([
			"sap/ui/model/json/JSONModel",
			"sap/suite/ui/microchart/LineMicroChartEmphasizedPoint",
			"sap/suite/ui/microchart/LineMicroChartPoint",
			"sap/ui/base/ManagedObject",
			"sap/ui/base/BindingParser",
			"sap/m/MessageToast"
		], function (JSONModel, LineMicroChartEmphasizedPoint, LineMicroChartPoint, ManagedObject, BindingParser,
					 MessageToast) {

			// dont know why i have to set this manually
			// probably something that is not used by default when instantiating xmlview manually
			// without this, complex binding in XML using object definition like {path:'lines'} doesn't work // TODO WHY
			ManagedObject.bindingParser = BindingParser.complexParser;

			sap.ui.controller("myController", {
				onInit: function () {
					var oSettings = {
						lines: [
							{
								points: [
									{x: 0, y: 53, show: true, emphasized: false, color: "Neutral"},
									{x: 8, y: 40, show: false, emphasized: false, color: "Neutral"},
									{x: 20, y: 10, show: false, emphasized: false, color: "Neutral"},
									{x: 30, y: 30, show: true, emphasized: false, color: "Neutral"},
									{x: 40, y: 52, show: true, emphasized: false, color: "Neutral"},
									{x: 100, y: 73, show: true, emphasized: false, color: "Neutral"}
								],
								showPoints: false,
								color: "Neutral",
								type: "Solid"
							}
						],
						size: "Auto",
						threshold: 0,
						showThresholdLine: true,
						showThresholdValue: false,
						thresholdDisplayValue: "",
						leftTopLabel: "120 Mio",
						rightTopLabel: "140 Mio",
						leftBottomLabel: "Sept 2016",
						rightBottomLabel: "Oct 2016"
					};

					var oConfModel = new JSONModel();
					oConfModel.setData(oSettings);
					this.getView().setModel(oConfModel);
				},

				fnPointsFactory: function (sId, oContext) {
					var oPoint;

					if (oContext.getProperty("emphasized")) {
						oPoint = new LineMicroChartEmphasizedPoint({
							x: oContext.getProperty("x"),
							y: oContext.getProperty("y"),
							show: oContext.getProperty("show"),
							color: oContext.getProperty("color")
						});
					} else {
						oPoint = new LineMicroChartPoint({
							x: oContext.getProperty("x"),
							y: oContext.getProperty("y")
						});
					}

					return oPoint;
				},

				fnRefresh: function () {
					this.getView().getModel().refresh(true);
				},

				fnAddLine: function () {
					var oModel = this.getView().getModel();
					var oLine = {
						points: [],
						showPoints: false,
						color: "Neutral",
						type: "Solid"
					};

					oModel.getProperty("/").lines.push(oLine);
					oModel.refresh(true);
				},

				fnAddPoint: function (oEvent) {
					var oContext = oEvent.getSource().getBindingContext();

					var oPoint = {x: null, y: null, show: true, emphasized: false, color: "Neutral"};

					oContext.getModel().getProperty(oContext.getPath()).points.push(oPoint);
					oContext.getModel().refresh(true);
				},

				fnRemoveObject: function (oEvent) {
					var oContext = oEvent.getSource().getBindingContext();
					var sPath = oContext.getPath();
					var aSplit = sPath.split("/");
					var iPoint = aSplit.slice(-1);

					sPath = aSplit.slice(0, -1).join("/");
					oContext.getModel().getProperty(sPath).splice(iPoint, 1);
					this.getView().getModel().refresh(true);
				},

				fnPress: function (oEvent) {
					MessageToast.show("The chart is pressed.");
				}
			});

			var oView = sap.ui.xmlview({viewContent: jQuery('#myXml').html()});
			oView.placeAt("content");

		});

	</script>
</head>

<body class="sapUiBody" role="application">
<div id="content"></div>
</body>
</html>
