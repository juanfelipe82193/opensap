<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Suite Controls - Coverage</title>
	<style>
		iframe {
			width: 100%;
			height: 500px;
			margin-bottom: 20px;
		}

		table {
			width: 100%;
			border-collapse: collapse;
		}

		th, td {
			padding: 8px;
			text-align: left;
			border-bottom: 1px solid #ddd;
		}

		tr:hover {
			background-color: #f5f5f5;
		}

		.critical {
			color: red;
		}
	</style>
	<script id="sap-ui-bootstrap"
			type="text/javascript"
			src="../../../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="base"
			data-sap-ui-language="en"
			data-sap-ui-debug="true"
			data-sap-ui-resourceroots='{"test.sap.suite.ui.commons.qunit": "./"}'>
	</script>
	<script>
		var sStarterPath = "/resources/sap/ui/test/starter/Test.qunit.html?testsuite=";

		var files = [
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=TAccount&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=MicroProcessFlow&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=CalculationBuilder&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=Timeline&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=NetworkGraph&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=StatusIndicator&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=ChartContainer&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=ProcessFlow&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/commons/qunit/testsuite.qunit&test=ImageEditor&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartAreaMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartBulletMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartColumnMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartComparisonMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartDeltaMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartLineMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartMicroChartBase&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartRadialMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartStackedBarMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartMultiEdit&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/ui/comp/qunit/testsuite.suitecontrols.qunit&test=SmartMultiInput&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=AreaMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=BulletMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=ColumnMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=ComparisonMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=DeltaMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=HarveyBallMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=InteractiveBarChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=InteractiveDonutChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=InteractiveLineChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=LineMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=RadialMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/suite/ui/microchart/qunit/testsuite.qunit&test=StackedBarMicroChart&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=GenericTile&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=FeedContent&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=ImageContent&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=NewsContent&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=NumericContent&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=TileContent&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=SlideTile&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=PDFViewer&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=UploadCollection&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=UploadCollectionItem&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=FeedInput&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=FeedListItem&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=SelectionDetails&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=SelectionDetailsItem&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=SelectionDetailsItemLine&coverage&sap-ui-debug=true",
			sStarterPath + "test-resources/sap/m/qunit/testsuite.mobile.qunit&test=HeaderContainer&coverage&sap-ui-debug=true"
		];


		var currentTest = 0;
		var contextPath = "/" + window.location.pathname.split("/")[1];
		files = files.map(function (file) {
			return contextPath + file;
		});

		function waitForTest() {
			return new Promise(function (resolve, reject) {
				function checkDone() {
					var iFrame = document.getElementById("iframe");
					var reschedule = true;
					if (iFrame) {
						var banner = iFrame.contentDocument.getElementById("qunit-banner");
						if (banner && banner.classList.length > 0) {
							reschedule = false;
							resolve();
						}
					}
					if (reschedule) {
						setTimeout(checkDone, 1000);
					}
				}

				checkDone();
			});
		}

		function nextTest() {
			var grandTotal = document.getElementById("iframe").contentDocument.getElementsByClassName("grand-total")[0];
			var percentage = "n/a", lines = "n/a", isCritical = false;
			if (grandTotal) {
				percentage = grandTotal.children[1].innerHTML;
				var percentageVal = Number(percentage.substr(0, percentage.length - 1));
				isCritical = percentageVal < 80;
				lines = grandTotal.children[2].innerHTML;
			}
			var fileLink = "<a href='" + files[currentTest] + "'>" + files[currentTest] + "</a>";
			$("#resultBody").append("<tr><td>" + fileLink + "</td><td class='" + (isCritical ? "critical" : "") + "'>" + percentage + "</td><td>" + lines + "</td></tr>");
			currentTest += 1;
			if (currentTest < files.length) {
				runTest(files[currentTest]);
			}
		}

		function runTest(sTestPath) {
			var iframePlaceholder = $("#iframe_placeholder");
			iframePlaceholder.empty();
			$("#actualId").html(sTestPath + " " + (currentTest + 1) + " of " + files.length);
			var iframe = $("<iframe />", {
				id: "iframe",
				loaded: function () {
					waitForTest().then(nextTest);
				},
				src: sTestPath
			});
			iframePlaceholder.append(iframe);
		}

		function start() {
			runTest(files[0]);
		}
	</script>
</head>
<body>
<div>Running: <span id="actualId"></span></div>
<div id="iframe_placeholder"></div>
<table>
	<thead>
	<tr>
		<th>File</th>
		<th>Percentage</th>
		<th>Line Coverage</th>
	</tr>
	</thead>
	<tbody id="resultBody">
	</tbody>
</table>
<script>
	start();
</script>
</body>
</html>
